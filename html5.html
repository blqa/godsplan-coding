<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GodsPlan | Coding: HTML5</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Iconos Lucide -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Confetti -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        // Paleta personalizada basada en tu snippet
                        slate: {
                            850: '#1e293b',
                            900: '#0f172a',
                            950: '#020617', // Fondo principal muy oscuro
                        },
                        orange: {
                            400: '#fb923c',
                            500: '#f97316',
                            600: '#ea580c',
                            900: '#7c2d12',
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['Fira Code', 'monospace'],
                    },
                    animation: {
                        'pulse-glow': 'pulse-glow 2s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'shake': 'shake 0.5s cubic-bezier(.36,.07,.19,.97) both',
                    },
                    keyframes: {
                        'pulse-glow': {
                            '0%, 100%': { opacity: 1, boxShadow: '0 0 10px rgba(249, 115, 22, 0.5)' },
                            '50%': { opacity: .5, boxShadow: '0 0 20px rgba(249, 115, 22, 0.1)' },
                        },
                        shake: {
                            '10%, 90%': { transform: 'translate3d(-1px, 0, 0)' },
                            '20%, 80%': { transform: 'translate3d(2px, 0, 0)' },
                            '30%, 50%, 70%': { transform: 'translate3d(-4px, 0, 0)' },
                            '40%, 60%': { transform: 'translate3d(4px, 0, 0)' }
                        }
                    }
                }
            }
        }
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&family=Fira+Code:wght@400;500&display=swap');
        
        body { font-family: 'Inter', sans-serif; background-color: #020617; color: #e2e8f0; }
        .font-mono { font-family: 'Fira Code', monospace; }

        /* Custom Scrollbar Orange Theme */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #020617; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #f97316; }

        /* Syntax Highlight Basics */
        .token-tag { color: #f97316; } /* Orange tags */
        .token-attr { color: #fb923c; } /* Lighter orange attributes */
        .token-val { color: #a3e635; } /* Lime Green values */
        .token-comment { color: #64748b; font-style: italic; }
        .token-punct { color: #94a3b8; }
        .token-js { color: #fbbf24; }

        .code-editor-area {
            background-image: radial-gradient(#334155 1px, transparent 1px);
            background-size: 20px 20px;
        }

        /* Nav Item Active State matching the user request style */
        .nav-item.active {
            background: linear-gradient(to right, rgba(249, 115, 22, 0.1), transparent);
            border-left: 3px solid #f97316;
            color: #fb923c;
        }
        
        textarea:focus { outline: none; }
        
        .glass-panel {
            background: rgba(15, 23, 42, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
    </style>
</head>
<body class="h-screen flex flex-col overflow-hidden selection:bg-orange-500/30 selection:text-orange-200">

    <!-- Header -->
    <header class="h-16 border-b border-slate-800 bg-slate-950 flex items-center justify-between px-4 md:px-6 z-50 shrink-0 relative">
        <!-- Glow Effect under header -->
        <div class="absolute bottom-0 left-0 w-full h-[1px] bg-gradient-to-r from-transparent via-orange-500/50 to-transparent"></div>

        <div class="flex items-center gap-4">
            <!-- Mobile Menu Trigger -->
            <button onclick="toggleSidebar()" class="md:hidden p-2 text-slate-400 hover:text-white">
                <i data-lucide="menu" class="w-6 h-6"></i>
            </button>
            
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-orange-600 to-orange-400 flex items-center justify-center shadow-lg shadow-orange-500/20">
                    <i data-lucide="file-code-2" class="text-white w-6 h-6"></i>
                </div>
                <div>
                    <h1 class="font-bold text-white tracking-tight leading-none text-lg">
                        GodsPlan | Coding: <span class="text-orange-500">HTML5</span>
                    </h1>
                    <span class="text-[10px] text-slate-500 uppercase tracking-widest font-semibold">Interactive Course</span>
                </div>
            </div>
        </div>

        <div class="flex items-center gap-4 md:gap-6">
            <!-- Progress Bar -->
            <div class="hidden md:flex flex-col items-end w-48">
                <div class="flex items-center gap-2 text-[10px] font-bold uppercase text-slate-500 mb-1">
                    <span>Progreso Global</span>
                    <span id="progress-text" class="text-orange-400">0%</span>
                </div>
                <div class="w-full h-1.5 bg-slate-900 rounded-full overflow-hidden border border-slate-800">
                    <div id="progress-bar" class="h-full bg-gradient-to-r from-orange-600 to-orange-400 w-0 transition-all duration-700 ease-out shadow-[0_0_10px_rgba(249,115,22,0.5)]"></div>
                </div>
            </div>

            <!-- BOTÃ“N SOLICITADO: VOLVER A INDEX -->
            <a href="https://coding.godsplan.site/" onclick="window.location.reload()" class="group relative px-4 py-2 bg-slate-900 border border-slate-800 hover:border-orange-500/50 rounded-lg transition-all duration-300 flex items-center gap-2 text-sm text-slate-400 hover:text-white hover:-translate-y-0.5 shadow-lg hover:shadow-orange-500/10">
                <i data-lucide="home" class="w-4 h-4 group-hover:text-orange-500 transition-colors"></i>
                <span class="hidden sm:inline font-medium">Volver al Index</span>
            </a>
        </div>
    </header>

    <!-- Layout Principal -->
    <div class="flex-1 flex overflow-hidden relative bg-slate-950">
        
        <!-- Mobile Overlay -->
        <div id="mobile-overlay" onclick="toggleSidebar()" class="fixed inset-0 bg-black/80 z-30 opacity-0 pointer-events-none transition-opacity duration-300 md:hidden backdrop-blur-sm"></div>

        <!-- Sidebar -->
        <aside class="w-72 bg-slate-900/50 border-r border-slate-800 flex flex-col shrink-0 transition-transform duration-300 absolute md:relative z-40 h-full -translate-x-full md:translate-x-0 backdrop-blur-md" id="sidebar">
            <div class="p-5 border-b border-slate-800/50">
                <h2 class="text-xs font-bold text-slate-500 uppercase tracking-widest flex items-center gap-2">
                    <i data-lucide="list" class="w-3 h-3"></i> MÃ³dulos
                </h2>
                <button onclick="toggleSidebar()" class="md:hidden absolute top-4 right-4 text-slate-400 hover:text-orange-500"><i data-lucide="x" class="w-5 h-5"></i></button>
            </div>
            
            <nav id="module-list" class="flex-1 overflow-y-auto py-4 space-y-1 px-3 custom-scrollbar">
                <!-- Se llena con JS -->
            </nav>
            
            <div class="p-4 border-t border-slate-800/50 bg-slate-900/80">
                <button onclick="resetProgress()" class="w-full text-xs text-slate-500 hover:text-red-400 flex items-center justify-center gap-2 transition-colors py-2">
                    <i data-lucide="rotate-ccw" class="w-3 h-3"></i> Reiniciar Progreso
                </button>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="flex-1 flex flex-col lg:flex-row min-w-0 bg-slate-950 relative">
            
            <!-- Left: Theory & Exercise -->
            <section class="flex-1 overflow-y-auto scroll-smooth custom-scrollbar relative" id="scroll-container">
                <div class="max-w-3xl mx-auto p-6 lg:p-10 pb-32">
                    
                    <!-- Content Injection -->
                    <div id="lesson-content" class="mb-12"></div>

                    <!-- Interactive Workspace -->
                    <div id="workspace-area" class="hidden space-y-8 animate-[fadeIn_0.5s_ease-out]">
                        
                        <!-- Exercise Card -->
                        <div class="rounded-xl overflow-hidden border border-slate-800 bg-[#0b101b] shadow-2xl">
                            <!-- Toolbar -->
                            <div class="bg-slate-900/50 px-4 py-3 flex justify-between items-center border-b border-slate-800">
                                <div class="flex items-center gap-2">
                                    <div class="w-2 h-2 rounded-full bg-orange-500 animate-pulse"></div>
                                    <span class="text-xs font-bold text-slate-300 uppercase tracking-wider">Editor de CÃ³digo</span>
                                </div>
                                <span id="difficulty-badge" class="px-2 py-0.5 rounded text-[10px] font-bold bg-slate-800 text-slate-400 border border-slate-700 uppercase">
                                    BÃ¡sico
                                </span>
                            </div>

                            <!-- Instructions -->
                            <div class="bg-gradient-to-b from-slate-900 to-[#0b101b] p-5 border-b border-slate-800/50">
                                <h3 class="text-orange-400 font-semibold mb-2 flex items-center gap-2 text-sm uppercase tracking-wide">
                                    <i data-lucide="terminal" class="w-4 h-4"></i>
                                    MisiÃ³n
                                </h3>
                                <p id="exercise-instruction" class="text-slate-300 text-sm leading-relaxed"></p>
                            </div>

                            <!-- Code Input -->
                            <div class="relative code-editor-area group">
                                <textarea id="code-input" spellcheck="false" 
                                    class="w-full h-56 bg-transparent p-5 font-mono text-sm text-slate-200 resize-y border-none focus:ring-0 leading-relaxed tab-size-4 placeholder-slate-700"
                                    placeholder="<!-- Escribe tu cÃ³digo aquÃ­... -->"></textarea>
                            </div>

                            <!-- Action Bar -->
                            <div class="p-4 bg-slate-900 border-t border-slate-800 flex flex-col sm:flex-row justify-between items-center gap-4">
                                <div id="feedback-msg" class="w-full sm:w-auto text-xs font-medium px-3 py-2 rounded transition-all opacity-0 text-center sm:text-left border border-transparent"></div>
                                
                                <div class="flex gap-3 w-full sm:w-auto">
                                    <button onclick="showHint()" id="btn-help" class="hidden px-4 py-2 bg-slate-800 hover:bg-slate-700 text-slate-400 hover:text-white border border-slate-700 rounded-lg transition-all text-xs font-bold uppercase tracking-wide items-center justify-center gap-2">
                                        <i data-lucide="life-buoy" class="w-3 h-3"></i> Pista
                                    </button>
                                    
                                    <button onclick="validateCode()" class="flex-1 sm:flex-none px-6 py-2 bg-gradient-to-r from-orange-600 to-orange-500 hover:from-orange-500 hover:to-orange-400 text-white text-xs font-bold uppercase tracking-widest rounded-lg shadow-[0_0_15px_rgba(249,115,22,0.3)] hover:shadow-[0_0_20px_rgba(249,115,22,0.5)] transition-all flex items-center justify-center gap-2 transform active:scale-95">
                                        <i data-lucide="play" class="w-3 h-3 fill-current"></i> Verificar
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Quiz Section -->
                        <div id="quiz-container" class="hidden bg-slate-900/50 border border-slate-800 rounded-xl p-6 relative overflow-hidden group hover:border-orange-500/30 transition-colors duration-500">
                            <!-- DecoraciÃ³n de fondo -->
                            <div class="absolute -right-10 -top-10 w-40 h-40 bg-orange-500/5 rounded-full blur-3xl group-hover:bg-orange-500/10 transition-colors"></div>
                            
                            <div class="flex items-start gap-4 relative z-10">
                                <div class="w-10 h-10 rounded-lg bg-slate-800 flex items-center justify-center shrink-0 text-orange-500 border border-slate-700">
                                    <i data-lucide="help-circle" class="w-5 h-5"></i>
                                </div>
                                <div class="flex-1">
                                    <h3 class="text-base font-bold text-white mb-2">Pregunta RÃ¡pida</h3>
                                    <p id="quiz-question" class="text-slate-400 mb-5 text-sm"></p>
                                    <div id="quiz-options" class="space-y-2.5"></div>
                                </div>
                            </div>
                        </div>

                    </div>

                    <!-- Navigation -->
                    <div class="mt-16 flex justify-between items-center pt-8 border-t border-slate-800/50">
                        <button onclick="prevLesson()" id="btn-prev" class="group px-4 py-2 text-slate-500 hover:text-orange-400 transition-colors flex items-center gap-2 text-sm font-medium disabled:opacity-30 disabled:pointer-events-none">
                            <i data-lucide="arrow-left" class="w-4 h-4 group-hover:-translate-x-1 transition-transform"></i> Anterior
                        </button>
                        <button onclick="nextLesson()" id="btn-next" class="px-6 py-2.5 bg-slate-800 hover:bg-slate-700 text-white rounded-lg transition-all flex items-center gap-2 text-sm font-bold border border-slate-700 hover:border-orange-500/50 shadow-lg disabled:opacity-50 disabled:cursor-not-allowed">
                            Siguiente <i data-lucide="arrow-right" class="w-4 h-4"></i>
                        </button>
                    </div>

                </div>
            </section>

            <!-- Right: Live Preview -->
            <section class="hidden lg:flex w-[45%] xl:w-[40%] flex-col border-l border-slate-800 bg-[#020617] relative z-10">
                
                <!-- Tab Header -->
                <div class="h-10 bg-[#0f172a] border-b border-slate-800 flex items-end px-2 gap-1">
                    <div class="px-4 py-2 bg-slate-900 text-orange-400 text-xs font-mono border-t border-x border-slate-800 rounded-t-md flex items-center gap-2 relative top-[1px] border-b-slate-900">
                        <i data-lucide="globe" class="w-3 h-3"></i> preview.html
                    </div>
                    <div class="ml-auto flex items-center px-3 py-2 gap-2">
                        <span class="relative flex h-2 w-2">
                          <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
                          <span class="relative inline-flex rounded-full h-2 w-2 bg-green-500"></span>
                        </span>
                        <span class="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Live</span>
                    </div>
                </div>

                <!-- Reference Code (Read Only) -->
                <div class="h-1/3 overflow-hidden bg-[#0f172a] border-b border-slate-800 flex flex-col relative group">
                    <div class="absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity">
                         <span class="text-[10px] bg-slate-800 text-slate-400 px-2 py-1 rounded border border-slate-700">Ejemplo</span>
                    </div>
                    <pre id="reference-code" class="flex-1 p-5 font-mono text-xs text-slate-400 overflow-auto custom-scrollbar select-text leading-relaxed"></pre>
                </div>

                <!-- Iframe Preview -->
                <div class="flex-1 flex flex-col bg-white">
                    <div class="h-8 bg-slate-100 border-b border-slate-200 flex items-center px-3 gap-2 shrink-0">
                        <div class="flex gap-1.5 opacity-50 hover:opacity-100 transition-opacity">
                            <div class="w-2.5 h-2.5 rounded-full bg-slate-400"></div>
                            <div class="w-2.5 h-2.5 rounded-full bg-slate-400"></div>
                            <div class="w-2.5 h-2.5 rounded-full bg-slate-400"></div>
                        </div>
                        <div class="flex-1 bg-white h-5 rounded border border-slate-200 flex items-center px-2 shadow-sm ml-2">
                            <i data-lucide="lock" class="w-2.5 h-2.5 text-slate-400 mr-1.5"></i>
                            <span class="text-[9px] text-slate-400 font-sans">localhost:8080</span>
                        </div>
                    </div>
                    <iframe id="preview-frame" class="flex-1 w-full border-none bg-white"></iframe>
                </div>
            </section>
        </main>
    </div>

    <!-- Modal de Completado -->
    <div id="completion-modal" class="fixed inset-0 z-[60] hidden items-center justify-center">
        <div class="absolute inset-0 bg-black/90 backdrop-blur-sm"></div>
        <div class="bg-slate-900 border border-orange-500/30 p-8 rounded-2xl shadow-[0_0_50px_rgba(249,115,22,0.2)] relative z-10 max-w-sm w-full mx-4 text-center transform scale-95 opacity-0 transition-all duration-500" id="modal-content">
            <div class="w-20 h-20 bg-gradient-to-tr from-orange-600 to-yellow-500 rounded-full flex items-center justify-center mx-auto mb-6 shadow-lg shadow-orange-500/40 animate-pulse-glow">
                <i data-lucide="trophy" class="w-10 h-10 text-white fill-white/20"></i>
            </div>
            <h2 class="text-3xl font-bold text-white mb-2">Â¡Curso Completado!</h2>
            <div class="h-1 w-20 bg-gradient-to-r from-transparent via-orange-500 to-transparent mx-auto mb-4"></div>
            <p class="text-slate-400 text-sm mb-8 leading-relaxed">Has dominado la estructura, semÃ¡ntica y componentes avanzados de HTML5.</p>
            <button onclick="closeModal()" class="w-full py-3 bg-white text-orange-600 font-bold uppercase tracking-widest rounded-lg hover:bg-orange-50 transition-colors shadow-lg">
                Continuar Aprendiendo
            </button>
        </div>
    </div>

    <!-- Data & Logic -->
    <script>
        // --- 1. CONFIGURACIÃ“N ---
        const STORAGE_KEY = 'html5_master_orange_v1';
        
        let state = {
            currentIndex: 0,
            progress: 0,
            completedLessons: []
        };

        const curriculum = [
            {
                id: "intro",
                title: "1. Estructura Vital",
                content: `
                    <span class="text-orange-500 font-mono text-[10px] font-bold uppercase mb-2 block tracking-[0.2em]">MÃ³dulo 01</span>
                    <h1 class="text-3xl md:text-4xl font-extrabold text-white mb-6">El Esqueleto HTML5</h1>
                    <div class="prose prose-invert max-w-none text-slate-400">
                        <p class="mb-4 text-lg text-slate-300">Bienvenido al desarrollo moderno. Todo comienza con la estructura base.</p>
                        <div class="bg-slate-900 border-l-2 border-orange-500 p-4 rounded-r-lg mb-6">
                            <h3 class="text-orange-400 font-bold text-sm mb-2 uppercase">Reglas de Oro</h3>
                            <ul class="text-sm space-y-2 list-none">
                                <li class="flex gap-2"><span class="text-orange-500 font-mono">></span> <strong>!DOCTYPE html</strong>: La declaraciÃ³n moderna.</li>
                                <li class="flex gap-2"><span class="text-orange-500 font-mono">></span> <strong>html</strong>: La raÃ­z del documento.</li>
                                <li class="flex gap-2"><span class="text-orange-500 font-mono">></span> <strong>body</strong>: Lo que ve el usuario.</li>
                            </ul>
                        </div>
                    </div>
                `,
                codeRef: `<!DOCTYPE html>
<html lang="es">
  <head>
    <title>Hola</title>
  </head>
  <body>
    <h1>Bienvenido</h1>
  </body>
</html>`,
                exercise: {
                    instruction: "Inicializa el documento. Escribe el DOCTYPE, html, head y body.",
                    placeholder: "<!DOCTYPE html>\n<html>\n...",
                    difficulty: "Inicial",
                    validate: (code) => {
                        const c = code.toLowerCase().replace(/\s/g, '');
                        if(!c.includes('<!doctypehtml>')) return {valid:false, msg:"Falta <!DOCTYPE html> al inicio."};
                        if(!c.includes('<html>') || !c.includes('</html>')) return {valid:false, msg:"Falta cerrar <html>."};
                        if(!c.includes('<body>')) return {valid:false, msg:"Falta la etiqueta <body>."};
                        return {valid:true, msg:"Â¡Estructura perfecta! Sistema en lÃ­nea."};
                    }
                },
                quiz: {
                    q: "Â¿QuÃ© etiqueta contiene los metadatos invisibles?",
                    options: ["<body>", "<head>", "<footer>"],
                    correct: 1
                }
            },
            {
                id: "links",
                title: "2. HipervÃ­nculos",
                content: `
                    <span class="text-orange-500 font-mono text-[10px] font-bold uppercase mb-2 block tracking-[0.2em]">MÃ³dulo 02</span>
                    <h1 class="text-3xl md:text-4xl font-extrabold text-white mb-6">Conexiones Globales</h1>
                    <div class="prose prose-invert max-w-none text-slate-400">
                        <p>La web es una red de enlaces. Usamos la etiqueta ancla <code>&lt;a&gt;</code>.</p>
                        <p class="mt-4">El atributo clave es <strong>href</strong> (Hypertext Reference).</p>
                        <div class="mt-4 p-3 bg-orange-500/10 border border-orange-500/20 rounded text-sm text-orange-200">
                            <strong>Tip Pro:</strong> Usa <code>target="_blank"</code> para abrir en nueva pestaÃ±a.
                        </div>
                    </div>
                `,
                codeRef: `<a href="https://google.com">Ir a Google</a>
<a href="#" target="_blank">Nueva pestaÃ±a</a>`,
                exercise: {
                    instruction: "Crea un enlace <a> que lleve a 'https://curso.com' y diga 'Entrar'.",
                    difficulty: "FÃ¡cil",
                    validate: (code) => {
                        const parser = new DOMParser();
                        const doc = parser.parseFromString(code, "text/html");
                        const a = doc.querySelector('a');
                        if(!a) return {valid:false, msg:"No encuentro la etiqueta <a>."};
                        if(a.getAttribute('href') !== 'https://curso.com') return {valid:false, msg:"El href debe ser 'https://curso.com'."};
                        if(a.innerText.trim() !== 'Entrar') return {valid:false, msg:"El texto del enlace debe ser 'Entrar'."};
                        return {valid:true, msg:"Â¡Enlace establecido correctamente!"};
                    }
                },
                quiz: {
                    q: "Â¿QuÃ© atributo define el destino del enlace?",
                    options: ["src", "link", "href"],
                    correct: 2
                }
            },
            {
                id: "img",
                title: "3. Media & Atributos",
                content: `
                    <span class="text-orange-500 font-mono text-[10px] font-bold uppercase mb-2 block tracking-[0.2em]">MÃ³dulo 03</span>
                    <h1 class="text-3xl md:text-4xl font-extrabold text-white mb-6">ImÃ¡genes</h1>
                    <div class="prose prose-invert max-w-none text-slate-400">
                        <p>La etiqueta <code>&lt;img&gt;</code> es "self-closing" (no tiene cierre).</p>
                        <ul class="list-disc pl-5 mt-4 space-y-2">
                            <li><strong>src</strong>: La fuente o URL de la imagen.</li>
                            <li><strong>alt</strong>: Texto alternativo (Vital para accesibilidad).</li>
                        </ul>
                    </div>
                `,
                codeRef: `<img src="logo.png" alt="Logotipo de la empresa" width="200">`,
                exercise: {
                    instruction: "Inserta una imagen con src='foto.jpg' y un alt='Usuario'.",
                    difficulty: "Medio",
                    validate: (code) => {
                        const doc = new DOMParser().parseFromString(code, "text/html");
                        const img = doc.querySelector('img');
                        if(!img) return {valid:false, msg:"Falta la etiqueta <img>."};
                        if(!img.getAttribute('src')) return {valid:false, msg:"Falta el atributo src."};
                        if(!img.getAttribute('alt')) return {valid:false, msg:"Falta el atributo alt (accesibilidad)."};
                        return {valid:true, msg:"Â¡Imagen renderizada!"};
                    }
                },
                quiz: {
                    q: "Â¿La etiqueta <img> necesita cierre </img>?",
                    options: ["SÃ­, siempre", "No, es self-closing", "Solo en HTML4"],
                    correct: 1
                }
            },
            {
                id: "semantic",
                title: "4. SemÃ¡ntica Pro",
                content: `
                    <span class="text-orange-500 font-mono text-[10px] font-bold uppercase mb-2 block tracking-[0.2em]">MÃ³dulo 04</span>
                    <h1 class="text-3xl md:text-4xl font-extrabold text-white mb-6">Arquitectura Web</h1>
                    <div class="prose prose-invert max-w-none text-slate-400">
                        <p>Deja de usar divs para todo. Dale significado a tu estructura.</p>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-6">
                            <div class="bg-slate-900 p-4 rounded border border-slate-800">
                                <code class="text-orange-400 font-bold">&lt;header&gt;</code>
                                <p class="text-xs mt-2 text-slate-500">Cabecera, logo, navegaciÃ³n principal.</p>
                            </div>
                            <div class="bg-slate-900 p-4 rounded border border-slate-800">
                                <code class="text-orange-400 font-bold">&lt;article&gt;</code>
                                <p class="text-xs mt-2 text-slate-500">Contenido independiente (posts, noticias).</p>
                            </div>
                        </div>
                    </div>
                `,
                codeRef: `<header>
  <nav>...</nav>
</header>
<main>
  <article>
    <h2>Blog Post</h2>
  </article>
</main>
<footer>...</footer>`,
                exercise: {
                    instruction: "Crea una estructura semÃ¡ntica: un <header> y dentro un <nav>.",
                    difficulty: "Intermedio",
                    validate: (code) => {
                        const doc = new DOMParser().parseFromString(code, "text/html");
                        if(!doc.querySelector('header')) return {valid:false, msg:"Falta <header>."};
                        if(!doc.querySelector('header > nav')) return {valid:false, msg:"El <nav> debe estar dentro del <header>."};
                        return {valid:true, msg:"Â¡Arquitectura semÃ¡ntica correcta!"};
                    }
                },
                quiz: {
                    q: "Â¿QuÃ© etiqueta usarÃ­as para el contenido principal Ãºnico?",
                    options: ["<div id='main'>", "<content>", "<main>"],
                    correct: 2
                }
            },
            {
                id: "forms",
                title: "5. Inputs y Datos",
                content: `
                    <span class="text-orange-500 font-mono text-[10px] font-bold uppercase mb-2 block tracking-[0.2em]">MÃ³dulo 05</span>
                    <h1 class="text-3xl md:text-4xl font-extrabold text-white mb-6">Formularios</h1>
                    <div class="prose prose-invert max-w-none text-slate-400">
                        <p>InteractÃºa con el usuario. El atributo <code>type</code> cambia todo.</p>
                        <ul class="text-sm space-y-2 mt-4 font-mono text-slate-300">
                            <li>type="text"</li>
                            <li>type="password"</li>
                            <li>type="email"</li>
                            <li>type="date"</li>
                        </ul>
                    </div>
                `,
                codeRef: `<form>
  <input type="email" placeholder="Tu correo" required>
  <button type="submit">Enviar</button>
</form>`,
                exercise: {
                    instruction: "Crea un campo de contraseÃ±a (<input type='password'>) con un placeholder 'Secreto'.",
                    difficulty: "Intermedio",
                    validate: (code) => {
                        const doc = new DOMParser().parseFromString(code, "text/html");
                        const inp = doc.querySelector('input');
                        if(!inp) return {valid:false, msg:"No veo el <input>."};
                        if(inp.getAttribute('type') !== 'password') return {valid:false, msg:"El tipo debe ser 'password'."};
                        if(inp.getAttribute('placeholder') !== 'Secreto') return {valid:false, msg:"El placeholder debe ser 'Secreto'."};
                        return {valid:true, msg:"Â¡Input seguro creado!"};
                    }
                },
                quiz: {
                    q: "Â¿QuÃ© atributo hace obligatorio un campo?",
                    options: ["mandatory", "validate", "required"],
                    correct: 2
                }
            },
            {
                id: "final",
                title: "6. Proyecto Final",
                content: `
                    <span class="text-orange-500 font-mono text-[10px] font-bold uppercase mb-2 block tracking-[0.2em]">MisiÃ³n Final</span>
                    <h1 class="text-3xl md:text-4xl font-extrabold text-white mb-6">Landing Page</h1>
                    <div class="prose prose-invert max-w-none text-slate-400">
                        <p>Es hora de combinar todo. Debes construir una mini landing page.</p>
                        <p class="mt-4"><strong>Requisitos:</strong></p>
                        <ul class="list-none space-y-2 mt-2">
                            <li class="flex items-center gap-2"><div class="w-1.5 h-1.5 bg-orange-500 rounded-full"></div> Un Header con tÃ­tulo h1.</li>
                            <li class="flex items-center gap-2"><div class="w-1.5 h-1.5 bg-orange-500 rounded-full"></div> Un Main con un pÃ¡rrafo p.</li>
                            <li class="flex items-center gap-2"><div class="w-1.5 h-1.5 bg-orange-500 rounded-full"></div> Un Footer con un enlace a.</li>
                        </ul>
                    </div>
                `,
                codeRef: `<header><h1>Mi App</h1></header>
<main>
  <p>Descarga la app ahora.</p>
</main>
<footer>
  <a href="#">Contacto</a>
</footer>`,
                exercise: {
                    instruction: "Construye la Landing Page completa siguiendo los requisitos.",
                    placeholder: "<header>...</header>\n<main>...</main>\n<footer>...</footer>",
                    difficulty: "Experto",
                    hint: "AsegÃºrate de que el enlace <a> estÃ© DENTRO del <footer>.",
                    validate: (code) => {
                        const doc = new DOMParser().parseFromString(code, "text/html");
                        if(!doc.querySelector('header h1')) return {valid:false, msg:"Falta el <h1> dentro del Header."};
                        if(!doc.querySelector('main p')) return {valid:false, msg:"Falta el <p> dentro del Main."};
                        if(!doc.querySelector('footer a')) return {valid:false, msg:"Falta el enlace <a> dentro del Footer."};
                        return {valid:true, msg:"Â¡MISIÃ“N CUMPLIDA! Eres un Master HTML5."};
                    }
                },
                quiz: {
                    q: "Â¿HTML5 es case-sensitive (distingue mayÃºsculas)?",
                    options: ["SÃ­, estricto", "No, pero minÃºsculas es buena prÃ¡ctica", "Solo en atributos"],
                    correct: 1
                }
            }
        ];

        // --- 2. LOGICA DEL SISTEMA ---
        
        document.addEventListener('DOMContentLoaded', () => {
            loadProgress();
            renderSidebar();
            loadLesson(state.currentIndex);
            setupTabSupport();
            lucide.createIcons();
        });

        function loadProgress() {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (saved) {
                try {
                    state = JSON.parse(saved);
                    // Asegurar Ã­ndices vÃ¡lidos
                    if(state.currentIndex >= curriculum.length) state.currentIndex = 0;
                } catch(e) { console.error(e); }
            }
        }

        function saveProgress() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
            updateProgressBar();
        }

        function resetProgress() {
            if(confirm("Â¿Reiniciar todo el curso?")) {
                localStorage.removeItem(STORAGE_KEY);
                location.reload();
            }
        }

        function renderSidebar() {
            const list = document.getElementById('module-list');
            list.innerHTML = curriculum.map((item, idx) => {
                const isCompleted = state.completedLessons.includes(idx);
                const activeClass = idx === state.currentIndex 
                    ? 'active' 
                    : 'text-slate-400 hover:text-white hover:bg-slate-800/50 border-transparent';
                
                return `
                <button onclick="loadLesson(${idx})" 
                    class="nav-item w-full text-left px-4 py-3 rounded-r-lg mb-1 flex items-center gap-3 text-sm font-medium transition-all border-l-4 group ${activeClass}">
                    <div class="flex flex-col items-center justify-center w-5 h-5 rounded ${isCompleted ? 'bg-green-500/10 text-green-500' : 'bg-slate-800 text-slate-500 group-hover:text-orange-400'}">
                        ${isCompleted ? '<i data-lucide="check" class="w-3 h-3"></i>' : `<span class="text-[10px] font-mono">${idx+1}</span>`}
                    </div>
                    <span class="truncate">${item.title}</span>
                </button>
            `}).join('');
            lucide.createIcons();
        }

        function loadLesson(index) {
            state.currentIndex = index;
            saveProgress();
            renderSidebar();
            
            // UI Updates
            if(window.innerWidth < 768) {
                document.getElementById('sidebar').classList.add('-translate-x-full');
                document.getElementById('mobile-overlay').classList.remove('open');
            }

            const data = curriculum[index];
            document.getElementById('lesson-content').innerHTML = data.content;
            document.getElementById('reference-code').innerHTML = syntaxHighlight(data.codeRef);
            updatePreview(data.codeRef);

            // Exercise Setup
            document.getElementById('workspace-area').classList.remove('hidden');
            document.getElementById('exercise-instruction').innerText = data.exercise.instruction;
            document.getElementById('difficulty-badge').innerText = data.exercise.difficulty;
            const codeInput = document.getElementById('code-input');
            codeInput.value = ""; 
            codeInput.placeholder = data.exercise.placeholder || "<!-- Tu cÃ³digo aquÃ­ -->";

            // Feedback Reset
            const fb = document.getElementById('feedback-msg');
            fb.style.opacity = '0';
            fb.innerText = '';
            
            // Hint Button
            const helpBtn = document.getElementById('btn-help');
            if (data.exercise.hint) {
                helpBtn.classList.remove('hidden');
                helpBtn.classList.add('flex');
            } else {
                helpBtn.classList.add('hidden');
                helpBtn.classList.remove('flex');
            }

            // Quiz Reset
            document.getElementById('quiz-container').classList.add('hidden');
            
            lucide.createIcons();
            document.getElementById('scroll-container').scrollTop = 0;
        }

        function updatePreview(code) {
            const iframe = document.getElementById('preview-frame');
            const doc = iframe.contentDocument || iframe.contentWindow.document;
            const styles = `
                <style>
                    body { font-family: sans-serif; padding: 20px; color: #333; } 
                    h1 { color: #ea580c; border-bottom: 2px solid #ea580c; padding-bottom: 5px; }
                    a { color: #f97316; text-decoration: none; font-weight: bold; }
                    a:hover { text-decoration: underline; }
                    button { background: #ea580c; color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer; }
                    input { border: 1px solid #ccc; padding: 5px; border-radius: 4px; width: 100%; box-sizing: border-box; margin-bottom: 10px; }
                    header, footer, main, article { border: 1px dashed #cbd5e1; padding: 10px; margin: 5px 0; background: #f8fafc; }
                    header::before, footer::before { content: attr(tagName); color: #94a3b8; font-size: 10px; text-transform: uppercase; display: block; margin-bottom: 5px;}
                </style>`;
            doc.open();
            doc.write(styles + code);
            doc.close();
        }

        function validateCode() {
            const data = curriculum[state.currentIndex].exercise;
            const userCode = document.getElementById('code-input').value;
            updatePreview(userCode);
            
            const result = data.validate(userCode);
            const fb = document.getElementById('feedback-msg');
            
            fb.innerText = result.msg;
            fb.style.opacity = '1';

            if(result.valid) {
                fb.className = "w-full sm:w-auto text-xs font-bold px-4 py-2 rounded bg-green-500/10 text-green-400 border border-green-500/20 shadow-[0_0_10px_rgba(74,222,128,0.1)]";
                setupQuiz(curriculum[state.currentIndex].quiz);
                confetti({ particleCount: 50, spread: 60, colors: ['#f97316', '#ffffff'] });
            } else {
                fb.className = "w-full sm:w-auto text-xs font-bold px-4 py-2 rounded bg-red-500/10 text-red-400 border border-red-500/20 animate-shake";
            }
        }

        function setupQuiz(quizData) {
            const container = document.getElementById('quiz-container');
            container.classList.remove('hidden');
            container.classList.add('animate-[fadeIn_0.5s_ease-out]');
            
            document.getElementById('quiz-question').innerText = quizData.q;
            const isDone = state.completedLessons.includes(state.currentIndex);

            document.getElementById('quiz-options').innerHTML = quizData.options.map((opt, i) => {
                let baseClass = "w-full text-left p-3 rounded-lg text-sm transition-all border flex justify-between items-center group";
                let styleClass = "bg-slate-800 border-slate-700 text-slate-300 hover:border-orange-500 hover:text-white";
                let icon = '<i data-lucide="circle" class="w-4 h-4 text-slate-600 group-hover:text-orange-500"></i>';
                let disabled = "";

                if(isDone) {
                    disabled = "disabled";
                    if(i === quizData.correct) {
                        styleClass = "bg-green-500/20 border-green-500/50 text-green-400";
                        icon = '<i data-lucide="check-circle" class="w-4 h-4 text-green-400"></i>';
                    } else {
                        styleClass = "bg-slate-900 border-slate-800 text-slate-600 opacity-50";
                    }
                }

                return `
                <button onclick="checkQuiz(this, ${i}, ${quizData.correct})" ${disabled} class="${baseClass} ${styleClass}">
                    <span>${opt}</span>
                    ${icon}
                </button>
            `}).join('');
            
            lucide.createIcons();
            // Auto scroll to quiz
            setTimeout(() => {
                container.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }, 100);
        }

        function checkQuiz(btn, selected, correct) {
            const allBtns = document.getElementById('quiz-options').children;
            
            if(selected === correct) {
                // Correcto
                btn.className = "w-full text-left p-3 rounded-lg text-sm transition-all border flex justify-between items-center bg-green-500/20 border-green-500/50 text-green-400 shadow-[0_0_15px_rgba(74,222,128,0.2)]";
                btn.querySelector('i').outerHTML = '<i data-lucide="check-circle" class="w-4 h-4 text-green-400"></i>';
                lucide.createIcons();
                
                // Deshabilitar
                Array.from(allBtns).forEach(b => b.disabled = true);
                
                if(!state.completedLessons.includes(state.currentIndex)) {
                    state.completedLessons.push(state.currentIndex);
                    saveProgress();
                }
                
                renderSidebar();
                confetti({ particleCount: 150, spread: 100, origin: { y: 0.6 } });

            } else {
                // Incorrecto
                btn.className = "w-full text-left p-3 rounded-lg text-sm transition-all border flex justify-between items-center bg-red-500/10 border-red-500/50 text-red-400 animate-shake";
                btn.querySelector('i').outerHTML = '<i data-lucide="x-circle" class="w-4 h-4 text-red-400"></i>';
                lucide.createIcons();
                btn.disabled = true;
            }
        }

        function updateProgressBar() {
            const pct = Math.round((state.completedLessons.length / curriculum.length) * 100);
            document.getElementById('progress-bar').style.width = `${pct}%`;
            document.getElementById('progress-text').innerText = `${pct}%`;
            
            document.getElementById('btn-prev').disabled = state.currentIndex === 0;
            const nextBtn = document.getElementById('btn-next');
            
            if(state.completedLessons.includes(state.currentIndex)) {
                nextBtn.disabled = false;
                nextBtn.classList.add('bg-orange-600', 'border-orange-500', 'hover:bg-orange-500');
                nextBtn.classList.remove('bg-slate-800');
            } else {
                nextBtn.disabled = true;
                nextBtn.classList.remove('bg-orange-600', 'border-orange-500', 'hover:bg-orange-500');
                nextBtn.classList.add('bg-slate-800');
            }
        }

        function nextLesson() {
            if(state.currentIndex < curriculum.length - 1) {
                loadLesson(state.currentIndex + 1);
            } else {
                showCompletionModal();
            }
        }

        function prevLesson() {
            if(state.currentIndex > 0) loadLesson(state.currentIndex - 1);
        }

        function showHint() {
            const hint = curriculum[state.currentIndex].exercise.hint;
            if(hint) {
                const fb = document.getElementById('feedback-msg');
                fb.innerText = "ðŸ’¡ " + hint;
                fb.className = "w-full sm:w-auto text-xs font-bold px-4 py-2 rounded bg-yellow-500/10 text-yellow-400 border border-yellow-500/20";
                fb.style.opacity = '1';
            }
        }

        // --- Helpers ---
        function toggleSidebar() {
            const sb = document.getElementById('sidebar');
            const ov = document.getElementById('mobile-overlay');
            sb.classList.toggle('-translate-x-full');
            ov.classList.toggle('open');
            if(ov.classList.contains('open')) {
                ov.style.opacity = '1';
                ov.style.pointerEvents = 'auto';
            } else {
                ov.style.opacity = '0';
                ov.style.pointerEvents = 'none';
            }
        }

        function setupTabSupport() {
            const ta = document.getElementById('code-input');
            ta.addEventListener('keydown', function(e) {
                if(e.key == 'Tab') {
                    e.preventDefault();
                    var s = this.selectionStart;
                    this.value = this.value.substring(0,this.selectionStart) + "  " + this.value.substring(this.selectionEnd);
                    this.selectionEnd = s + 2; 
                }
            });
        }

        function syntaxHighlight(code) {
             return code
                .replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;')
                .replace(/(&lt;\/?)(\w+)(.*?)(&gt;)/g, (match, p1, p2, p3, p4) => {
                    const attrs = p3.replace(/(\w+)=(".*?")/g, '<span class="token-attr">$1</span>=<span class="token-val">$2</span>');
                    return `<span class="token-punct">${p1}</span><span class="token-tag">${p2}</span>${attrs}<span class="token-punct">${p4}</span>`;
                });
        }

        function showCompletionModal() {
            const m = document.getElementById('completion-modal');
            const c = document.getElementById('modal-content');
            m.classList.remove('hidden');
            m.classList.add('flex');
            setTimeout(() => {
                c.classList.remove('scale-95', 'opacity-0');
                c.classList.add('scale-100', 'opacity-100');
            }, 10);
            confetti({ particleCount: 300, spread: 150, origin: { y: 0.6 } });
        }
        
        function closeModal() {
            document.getElementById('completion-modal').classList.add('hidden');
            document.getElementById('completion-modal').classList.remove('flex');
        }
    </script>
</body>
</html>
