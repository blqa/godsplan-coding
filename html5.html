<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTML5: Master Class Pro | Curso Interactivo</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Iconos Lucide -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Confetti -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        brand: {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            400: '#38bdf8',
                            500: '#0ea5e9',
                            600: '#0284c7',
                            900: '#0c4a6e',
                        },
                        dark: {
                            bg: '#0f172a', 
                            surface: '#1e293b', 
                            border: '#334155', 
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['Fira Code', 'monospace'],
                    },
                    animation: {
                        'bounce-slow': 'bounce 3s infinite',
                        'shake': 'shake 0.5s cubic-bezier(.36,.07,.19,.97) both',
                    },
                    keyframes: {
                        shake: {
                            '10%, 90%': { transform: 'translate3d(-1px, 0, 0)' },
                            '20%, 80%': { transform: 'translate3d(2px, 0, 0)' },
                            '30%, 50%, 70%': { transform: 'translate3d(-4px, 0, 0)' },
                            '40%, 60%': { transform: 'translate3d(4px, 0, 0)' }
                        }
                    }
                }
            }
        }
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Fira+Code:wght@400;500&display=swap');
        
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; color: #e2e8f0; }
        .font-mono { font-family: 'Fira Code', monospace; }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }

        /* Syntax Highlight Basics */
        .token-tag { color: #f472b6; } 
        .token-attr { color: #60a5fa; }
        .token-val { color: #a3e635; } 
        .token-comment { color: #64748b; font-style: italic; }
        .token-punct { color: #94a3b8; }
        .token-js { color: #fbbf24; }

        .code-editor-area {
            background-image: radial-gradient(#334155 1px, transparent 1px);
            background-size: 20px 20px;
        }

        /* Animations */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards; }

        .nav-item.active {
            background: linear-gradient(to right, rgba(14, 165, 233, 0.1), transparent);
            border-left: 3px solid #0ea5e9;
            color: #38bdf8;
        }
        
        textarea:focus { outline: none; }

        /* Mobile Overlay */
        #mobile-overlay.open {
            opacity: 1;
            pointer-events: auto;
        }
        
        /* Didactic Box Styles */
        .concept-box {
            background: rgba(30, 41, 59, 0.5);
            border-left: 4px solid #0ea5e9;
            padding: 1rem;
            margin-bottom: 1.5rem;
            border-radius: 0 0.5rem 0.5rem 0;
        }
        .example-tag {
            background: rgba(244, 114, 182, 0.1);
            color: #f472b6;
            padding: 0.1rem 0.3rem;
            border-radius: 0.25rem;
            font-family: monospace;
            font-size: 0.9em;
        }
    </style>
</head>
<body class="h-screen flex flex-col overflow-hidden">

    <!-- Header -->
    <header class="h-16 border-b border-dark-border bg-dark-bg/80 backdrop-blur-md flex items-center justify-between px-4 md:px-6 z-50 shrink-0">
        <div class="flex items-center gap-3">
            <!-- Mobile Menu Trigger -->
            <button onclick="toggleSidebar()" class="md:hidden p-2 text-slate-400 hover:text-white">
                <i data-lucide="menu" class="w-6 h-6"></i>
            </button>
            
            <div class="bg-gradient-to-tr from-brand-600 to-indigo-600 p-2 rounded-lg shadow-lg shadow-brand-500/20 hidden md:block">
                <i data-lucide="layers" class="text-white w-5 h-5"></i>
            </div>
            <div>
                <h1 class="font-bold text-white tracking-tight leading-tight flex items-center gap-2">
                    Master HTML5 <span class="text-[10px] bg-brand-900 text-brand-400 px-1.5 py-0.5 rounded border border-brand-500/30">PRO</span>
                </h1>
                <p class="text-[10px] text-slate-400 font-medium uppercase tracking-wider hidden md:block">Edición Didáctica</p>
            </div>
        </div>

        <div class="flex items-center gap-6">
            <div class="flex flex-col items-end">
                <div class="flex items-center gap-2 text-xs font-semibold uppercase text-slate-400 mb-1.5">
                    <span>Progreso</span>
                    <span id="progress-text" class="text-brand-500">0%</span>
                </div>
                <div class="w-24 md:w-32 h-1.5 bg-slate-800 rounded-full overflow-hidden">
                    <div id="progress-bar" class="h-full bg-brand-500 w-0 transition-all duration-700 ease-out shadow-[0_0_10px_rgba(14,165,233,0.5)]"></div>
                </div>
            </div>
            <!-- Reset Button -->
            <button onclick="resetProgress()" title="Reiniciar Curso" class="text-slate-500 hover:text-red-400 transition-colors">
                <i data-lucide="rotate-ccw" class="w-4 h-4"></i>
            </button>
        </div>
    </header>

    <!-- Layout Principal -->
    <div class="flex-1 flex overflow-hidden relative">
        
        <!-- Mobile Overlay -->
        <div id="mobile-overlay" onclick="toggleSidebar()" class="fixed inset-0 bg-black/60 z-30 opacity-0 pointer-events-none transition-opacity duration-300 md:hidden backdrop-blur-sm"></div>

        <!-- Sidebar -->
        <aside class="w-72 bg-dark-bg border-r border-dark-border flex flex-col shrink-0 transition-transform duration-300 absolute md:relative z-40 h-full -translate-x-full md:translate-x-0 shadow-2xl md:shadow-none" id="sidebar">
            <div class="p-4 border-b border-dark-border bg-dark-surface/30 flex justify-between items-center">
                <h2 class="text-xs font-bold text-slate-500 uppercase tracking-widest">Índice del Curso</h2>
                <button onclick="toggleSidebar()" class="md:hidden text-slate-400"><i data-lucide="x" class="w-4 h-4"></i></button>
            </div>
            <nav id="module-list" class="flex-1 overflow-y-auto py-2 space-y-0.5 custom-scrollbar">
                <!-- Se llena con JS -->
            </nav>
            
            <!-- User Profile footer -->
            <div class="p-4 border-t border-dark-border mt-auto bg-[#0b1120]">
                <div class="flex items-center gap-3">
                    <div class="w-8 h-8 rounded-full bg-gradient-to-r from-purple-500 to-pink-500 flex items-center justify-center text-xs font-bold text-white shadow-lg">
                        JS
                    </div>
                    <div>
                        <div class="text-sm font-medium text-white">Estudiante</div>
                        <div class="text-xs text-slate-500">Nivel Principiante</div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="flex-1 flex flex-col lg:flex-row min-w-0 bg-dark-bg relative">
            
            <!-- Left: Theory & Exercise -->
            <section class="flex-1 overflow-y-auto scroll-smooth custom-scrollbar relative" id="scroll-container">
                <div class="max-w-3xl mx-auto p-6 lg:p-12 pb-32">
                    
                    <!-- Content Injection -->
                    <div id="lesson-content" class="animate-fade-in mb-12"></div>

                    <!-- Interactive Workspace -->
                    <div id="workspace-area" class="hidden animate-fade-in space-y-8">
                        
                        <!-- Exercise Card -->
                        <div class="rounded-xl overflow-hidden border border-brand-500/30 shadow-2xl shadow-brand-900/20 bg-[#162032]">
                            <!-- Toolbar -->
                            <div class="bg-[#1e293b] px-4 py-3 flex justify-between items-center border-b border-slate-700">
                                <div class="flex items-center gap-2">
                                    <i data-lucide="code-2" class="w-4 h-4 text-brand-400"></i>
                                    <span class="text-xs font-bold text-slate-300 uppercase tracking-wider">Editor de Desafíos</span>
                                </div>
                                <span id="difficulty-badge" class="px-2 py-0.5 rounded text-[10px] font-bold bg-slate-700 text-slate-300 uppercase border border-slate-600">
                                    Básico
                                </span>
                            </div>

                            <!-- Instructions -->
                            <div class="bg-gradient-to-b from-[#1e293b] to-[#162032] p-5 border-b border-slate-800">
                                <h3 class="text-white font-semibold mb-2 flex items-center gap-2">
                                    <i data-lucide="terminal" class="w-4 h-4 text-yellow-500"></i>
                                    Tu Misión:
                                </h3>
                                <p id="exercise-instruction" class="text-slate-300 text-sm leading-relaxed"></p>
                            </div>

                            <!-- Code Input with Tab Support -->
                            <div class="relative code-editor-area group">
                                <div class="absolute top-3 right-3 text-[10px] text-slate-500 font-mono pointer-events-none bg-slate-900/50 px-2 py-1 rounded">HTML/JS</div>
                                <textarea id="code-input" spellcheck="false" 
                                    class="w-full h-48 bg-transparent p-5 font-mono text-sm text-slate-200 resize-y border-none focus:ring-0 leading-relaxed tab-size-4"
                                    placeholder="<!-- Escribe tu código aquí... -->"></textarea>
                            </div>

                            <!-- Action Bar -->
                            <div class="p-4 bg-[#1e293b] border-t border-slate-700 flex flex-col sm:flex-row justify-between items-center gap-4">
                                <div id="feedback-msg" class="w-full sm:w-auto text-xs font-medium px-3 py-1.5 rounded transition-all opacity-0 text-center sm:text-left"></div>
                                <button onclick="validateCode()" class="w-full sm:w-auto group relative px-5 py-2 bg-brand-600 hover:bg-brand-500 text-white text-sm font-semibold rounded-lg shadow-lg shadow-brand-600/20 transition-all flex items-center justify-center gap-2 overflow-hidden">
                                    <div class="absolute inset-0 w-full h-full bg-white/20 translate-y-full group-hover:translate-y-0 transition-transform duration-300"></div>
                                    <span class="relative z-10 flex items-center gap-2">
                                        <i data-lucide="play" class="w-4 h-4 fill-current"></i> Verificar Código
                                    </span>
                                </button>
                            </div>
                        </div>

                        <!-- Quiz Section (Hidden initially) -->
                        <div id="quiz-container" class="hidden bg-slate-800/50 border border-slate-700 rounded-xl p-6 backdrop-blur-sm relative overflow-hidden">
                            <div class="absolute top-0 right-0 w-32 h-32 bg-purple-500/10 rounded-full blur-3xl -mr-10 -mt-10 pointer-events-none"></div>
                            <div class="flex items-start gap-4 relative z-10">
                                <div class="w-10 h-10 rounded-full bg-purple-500/20 flex items-center justify-center shrink-0 text-purple-400 border border-purple-500/20">
                                    <i data-lucide="help-circle" class="w-6 h-6"></i>
                                </div>
                                <div class="flex-1">
                                    <h3 class="text-lg font-bold text-white mb-2">Pregunta Rápida</h3>
                                    <p id="quiz-question" class="text-slate-300 mb-4 text-sm"></p>
                                    <div id="quiz-options" class="space-y-2"></div>
                                </div>
                            </div>
                        </div>

                    </div>

                    <!-- Navigation -->
                    <div class="mt-12 flex justify-between items-center pt-8 border-t border-slate-800">
                        <button onclick="prevLesson()" id="btn-prev" class="px-4 py-2 text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg transition-colors flex items-center gap-2 text-sm font-medium disabled:opacity-30 disabled:pointer-events-none">
                            <i data-lucide="arrow-left" class="w-4 h-4"></i> Anterior
                        </button>
                        <button onclick="nextLesson()" id="btn-next" class="px-6 py-2.5 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-all flex items-center gap-2 text-sm font-bold shadow-lg disabled:opacity-50 disabled:cursor-not-allowed">
                            Siguiente <i data-lucide="arrow-right" class="w-4 h-4"></i>
                        </button>
                    </div>

                </div>
            </section>

            <!-- Right: Live Preview & Code Reference -->
            <section class="hidden lg:flex w-[45%] xl:w-[40%] flex-col border-l border-dark-border bg-[#0b1120] relative z-10">
                
                <!-- Tab Header -->
                <div class="h-10 bg-dark-bg border-b border-dark-border flex items-end px-2 gap-1">
                    <div class="px-4 py-2 bg-[#1e293b] text-blue-400 text-xs font-mono border-t-2 border-blue-500 rounded-t-md flex items-center gap-2">
                        <i data-lucide="file-code" class="w-3 h-3"></i> index.html
                    </div>
                    <div class="ml-auto flex items-center px-3 py-2 gap-2">
                        <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                        <span class="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Live Preview</span>
                    </div>
                </div>

                <!-- Read-only Code View -->
                <div class="h-1/2 overflow-hidden bg-[#1e293b] border-b-4 border-dark-bg flex flex-col">
                    <div class="flex justify-between items-center px-4 py-2 border-b border-slate-700/50 bg-[#1e293b]">
                        <span class="text-[10px] text-slate-500 font-bold uppercase">Ejemplo de Referencia</span>
                    </div>
                    <pre id="reference-code" class="flex-1 p-5 font-mono text-xs md:text-sm text-slate-300 overflow-auto custom-scrollbar select-text"></pre>
                </div>

                <!-- Browser Preview -->
                <div class="h-1/2 flex flex-col bg-white">
                    <div class="h-8 bg-slate-100 border-b border-slate-200 flex items-center px-3 gap-2 shrink-0">
                        <div class="flex gap-1.5">
                            <div class="w-2.5 h-2.5 rounded-full bg-red-400"></div>
                            <div class="w-2.5 h-2.5 rounded-full bg-yellow-400"></div>
                            <div class="w-2.5 h-2.5 rounded-full bg-green-400"></div>
                        </div>
                        <div class="flex-1 bg-white h-5 rounded border border-slate-200 flex items-center px-2 shadow-sm">
                            <i data-lucide="lock" class="w-2.5 h-2.5 text-slate-400 mr-1.5"></i>
                            <span class="text-[9px] text-slate-400 font-sans">localhost:8080/preview</span>
                        </div>
                    </div>
                    <iframe id="preview-frame" class="flex-1 w-full border-none bg-white"></iframe>
                </div>
            </section>
        </main>
    </div>

    <!-- Modal de Completado -->
    <div id="completion-modal" class="fixed inset-0 z-[60] hidden items-center justify-center">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm"></div>
        <div class="bg-[#1e293b] border border-slate-700 p-8 rounded-2xl shadow-2xl relative z-10 max-w-sm w-full mx-4 text-center transform scale-95 opacity-0 transition-all duration-300" id="modal-content">
            <div class="w-16 h-16 bg-gradient-to-tr from-yellow-400 to-orange-500 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg shadow-orange-500/30">
                <i data-lucide="trophy" class="w-8 h-8 text-white"></i>
            </div>
            <h2 class="text-2xl font-bold text-white mb-2">¡Curso Completado!</h2>
            <p class="text-slate-400 text-sm mb-6">Has dominado los conceptos esenciales de HTML5, incluyendo Multimedia y Canvas.</p>
            <button onclick="closeModal()" class="w-full py-2.5 bg-brand-600 hover:bg-brand-500 text-white font-semibold rounded-lg shadow-lg shadow-brand-500/20 transition-all">
                ¡Genial!
            </button>
        </div>
    </div>

    <!-- Data & Logic -->
    <script>
        // -------------------------------------------------------------------
        // 1. CONFIGURACIÓN Y ESTADO
        // -------------------------------------------------------------------
        
        const STORAGE_KEY = 'html5_masterclass_pro_v2';
        
        let state = {
            currentIndex: 0,
            progress: 0,
            completedLessons: [] // Array de IDs
        };

        const curriculum = [
            {
                id: "intro",
                title: "1. ¿Qué es HTML?",
                icon: "layout",
                content: `
                    <span class="text-brand-500 font-mono text-xs font-bold uppercase mb-2 block tracking-widest">Capítulo 1</span>
                    <h1 class="text-3xl md:text-4xl font-extrabold text-white mb-6">El Esqueleto de la Web</h1>
                    
                    <div class="prose prose-invert max-w-none text-slate-300">
                        <div class="concept-box">
                            <h3 class="text-white font-bold mb-2">Concepto: Etiquetas (Tags)</h3>
                            <p class="text-sm">HTML son piezas tipo Lego llamadas <strong>etiquetas</strong>. Casi siempre vienen en pares: apertura <code class="example-tag">&lt;p&gt;</code> y cierre <code class="example-tag">&lt;/p&gt;</code>.</p>
                        </div>
                        <p class="mb-4">Todo documento HTML5 necesita esta estructura básica:</p>
                        <ul class="list-none space-y-4 text-sm mb-6">
                            <li class="flex gap-3"><div class="w-8 h-8 rounded bg-slate-800 flex items-center justify-center shrink-0 font-bold text-brand-400">1</div><div><strong class="text-white">DOCTYPE:</strong> <code class="example-tag">&lt;!DOCTYPE html&gt;</code><p class="text-slate-400 mt-1">Le dice al navegador: "Esto es HTML moderno". Va siempre al principio.</p></div></li>
                            <li class="flex gap-3"><div class="w-8 h-8 rounded bg-slate-800 flex items-center justify-center shrink-0 font-bold text-brand-400">2</div><div><strong class="text-white">HTML:</strong> <code class="example-tag">&lt;html&gt;</code><p class="text-slate-400 mt-1">La caja que contiene todo el código.</p></div></li>
                        </ul>
                    </div>
                `,
                codeRef: `<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8">
    <title>Mi Web</title>
  </head>
  <body>
    <h1>Hola Mundo</h1>
  </body>
</html>`,
                exercise: {
                    instruction: "Escribe la estructura básica: el DOCTYPE, la etiqueta <html> y un <title> dentro del <head>.",
                    placeholder: "<!DOCTYPE html>\n<html>\n...",
                    difficulty: "Básico",
                    validate: (code) => {
                        const clean = code.toLowerCase().replace(/\s+/g, '');
                        if (!clean.includes('<!doctypehtml>')) return { valid: false, msg: "Falta <!DOCTYPE html> al principio." };
                        if (!clean.includes('<html')) return { valid: false, msg: "Falta la etiqueta <html>." };
                        if (!clean.includes('<title>')) return { valid: false, msg: "Añade un <title> dentro de <head>." };
                        return { valid: true, msg: "¡Perfecto! Ya tienes la base." };
                    }
                },
                quiz: {
                    q: "¿Qué parte del HTML contiene lo que el usuario ve en la pantalla?",
                    options: ["<head>", "<body>", "<doctype>"],
                    correct: 1
                }
            },
            {
                id: "semantics",
                title: "2. Semántica",
                icon: "columns",
                content: `
                    <span class="text-brand-500 font-mono text-xs font-bold uppercase mb-2 block tracking-widest">Capítulo 2</span>
                    <h1 class="text-3xl md:text-4xl font-extrabold text-white mb-6">Cajas con Significado</h1>
                    <div class="prose prose-invert max-w-none text-slate-300">
                        <p>No uses <code class="example-tag">&lt;div&gt;</code> para todo. Usa etiquetas que expliquen qué contienen:</p>
                        <div class="grid grid-cols-1 gap-3 my-6 text-sm">
                            <div class="bg-slate-800 p-3 rounded border-l-4 border-pink-500"><code class="text-pink-400 font-bold">&lt;header&gt;</code><p class="text-slate-300">Cabecera (Logo, menú).</p></div>
                            <div class="bg-slate-800 p-3 rounded border-l-4 border-purple-500"><code class="text-purple-400 font-bold">&lt;nav&gt;</code><p class="text-slate-300">Navegación (Links).</p></div>
                            <div class="bg-slate-800 p-3 rounded border-l-4 border-yellow-500"><code class="text-yellow-400 font-bold">&lt;footer&gt;</code><p class="text-slate-300">Pie de página.</p></div>
                        </div>
                    </div>
                `,
                codeRef: `<header>
    <nav>
        <a href="#">Inicio</a>
    </nav>
</header>
<footer>
    <p>Copyright 2024</p>
</footer>`,
                exercise: {
                    instruction: "Crea una barra de navegación. Usa <nav> y pon dos enlaces <a> dentro.",
                    difficulty: "Intermedio",
                    validate: (code) => {
                        const parser = new DOMParser();
                        const doc = parser.parseFromString(code, "text/html");
                        const nav = doc.querySelector('nav');
                        if (!nav) return { valid: false, msg: "Necesitas la etiqueta <nav>." };
                        if (nav.querySelectorAll('a').length < 2) return { valid: false, msg: "Pon al menos dos enlaces <a>." };
                        return { valid: true, msg: "¡Muy bien! Eso es semántica." };
                    }
                },
                quiz: {
                    q: "¿Qué etiqueta usarías para el pie de página?",
                    options: ["<bottom>", "<footer>", "<end>"],
                    correct: 1
                }
            },
            {
                id: "forms",
                title: "3. Formularios",
                icon: "check-square",
                content: `
                    <span class="text-brand-500 font-mono text-xs font-bold uppercase mb-2 block tracking-widest">Capítulo 3</span>
                    <h1 class="text-3xl md:text-4xl font-extrabold text-white mb-6">Pedir Datos</h1>
                    <div class="prose prose-invert max-w-none text-slate-300">
                        <div class="concept-box"><h3 class="text-white font-bold mb-2">&lt;input&gt;</h3><p class="text-sm">Es la caja donde el usuario escribe. El atributo <code>type</code> define qué es (email, password, date).</p></div>
                        <p class="text-sm">Usa <code>required</code> para obligar a llenarlo y <code>placeholder</code> para ayuda visual.</p>
                    </div>
                `,
                codeRef: `<form>
    <label>Email:</label>
    <input type="email" required placeholder="tu@correo.com">
    <button type="submit">Enviar</button>
</form>`,
                exercise: {
                    instruction: "Crea un input de tipo 'email' que sea obligatorio (required).",
                    difficulty: "Intermedio",
                    validate: (code) => {
                        const doc = new DOMParser().parseFromString(code, "text/html");
                        const input = doc.querySelector('input');
                        if (!input) return { valid: false, msg: "Falta la etiqueta <input>." };
                        if (input.getAttribute('type') !== 'email') return { valid: false, msg: "El type debe ser 'email'." };
                        if (!input.hasAttribute('required')) return { valid: false, msg: "Falta el atributo 'required'." };
                        return { valid: true, msg: "¡Correcto! El navegador validará el email." };
                    }
                },
                quiz: {
                    q: "¿Qué atributo muestra un texto gris temporal dentro del input?",
                    options: ["value", "helper", "placeholder"],
                    correct: 2
                }
            },
            {
                id: "svg",
                title: "4. Vectores (SVG)",
                icon: "pen-tool",
                content: `
                    <span class="text-brand-500 font-mono text-xs font-bold uppercase mb-2 block tracking-widest">Capítulo 4</span>
                    <h1 class="text-3xl md:text-4xl font-extrabold text-white mb-6">Gráficos SVG</h1>
                    <div class="prose prose-invert max-w-none text-slate-300">
                        <p>SVG son gráficos definidos por matemáticas, no píxeles. No se ven borrosos al hacer zoom.</p>
                        <ul class="list-disc pl-5 space-y-1 text-sm mt-4">
                            <li><strong>&lt;svg&gt;:</strong> El lienzo.</li>
                            <li><strong>&lt;circle&gt;:</strong> Círculo (usa cx, cy, r).</li>
                            <li><strong>&lt;rect&gt;:</strong> Rectángulo.</li>
                        </ul>
                    </div>
                `,
                codeRef: `<svg width="100" height="100">
  <circle cx="50" cy="50" r="40" fill="red" />
</svg>`,
                exercise: {
                    instruction: "Dibuja un círculo (<circle>) dentro de un <svg>.",
                    difficulty: "Avanzado",
                    validate: (code) => {
                        const doc = new DOMParser().parseFromString(code, "text/html");
                        if (!doc.querySelector('svg')) return { valid: false, msg: "Necesitas <svg>." };
                        if (!doc.querySelector('circle')) return { valid: false, msg: "Falta el <circle>." };
                        return { valid: true, msg: "¡Genial! Has creado un gráfico vectorial." };
                    }
                },
                quiz: {
                    q: "¿Qué pasa si haces zoom en un SVG?",
                    options: ["Se pixela", "Se ve nítido", "Desaparece"],
                    correct: 1
                }
            },
            {
                id: "storage",
                title: "5. LocalStorage",
                icon: "database",
                content: `
                    <span class="text-brand-500 font-mono text-xs font-bold uppercase mb-2 block tracking-widest">Capítulo 5</span>
                    <h1 class="text-3xl md:text-4xl font-extrabold text-white mb-6">Memoria del Navegador</h1>
                    <div class="prose prose-invert max-w-none text-slate-300">
                        <p><strong>LocalStorage</strong> permite guardar datos en el navegador que persisten tras recargar.</p>
                        <code class="block bg-black/30 p-2 rounded my-4 text-sm">localStorage.setItem('clave', 'valor');</code>
                    </div>
                `,
                codeRef: `<script>
  localStorage.setItem("usuario", "Ana");
  const nombre = localStorage.getItem("usuario");
  document.body.append("Hola " + nombre);
<\/script>`,
                exercise: {
                    instruction: "Usa JS para guardar 'HTML5' con la clave 'curso' en localStorage.",
                    placeholder: "<script>\n  localStorage.setItem(..., ...);\n<\/script>",
                    difficulty: "Experto",
                    validate: (code) => {
                        if (!code.includes('<script>')) return { valid: false, msg: "Usa etiquetas <script>." };
                        if (!code.includes('localStorage.setItem')) return { valid: false, msg: "Usa localStorage.setItem()." };
                        if (!code.includes('"curso"') && !code.includes("'curso'")) return { valid: false, msg: "La clave debe ser 'curso'." };
                        return { valid: true, msg: "¡Datos guardados!" };
                    }
                },
                quiz: {
                    q: "¿Cuándo se borran los datos de LocalStorage?",
                    options: ["Al cerrar navegador", "Nunca (salvo manual)", "Al apagar PC"],
                    correct: 1
                }
            },
            {
                id: "details",
                title: "6. Interactividad",
                icon: "layers",
                content: `
                    <span class="text-brand-500 font-mono text-xs font-bold uppercase mb-2 block tracking-widest">Capítulo 6</span>
                    <h1 class="text-3xl md:text-4xl font-extrabold text-white mb-6">Acordeones Nativos</h1>
                    <div class="prose prose-invert max-w-none text-slate-300">
                        <p>Crea secciones desplegables sin JavaScript usando <strong>&lt;details&gt;</strong> y <strong>&lt;summary&gt;</strong>.</p>
                    </div>
                `,
                codeRef: `<details>
  <summary>Más Información</summary>
  <p>Aquí está el contenido oculto.</p>
</details>`,
                exercise: {
                    instruction: "Crea un desplegable. El título (<summary>) debe decir 'Ayuda'.",
                    difficulty: "Fácil",
                    validate: (code) => {
                        const clean = code.toLowerCase();
                        if (!clean.includes('<details')) return { valid: false, msg: "Usa <details>." };
                        if (!clean.includes('<summary')) return { valid: false, msg: "Usa <summary>." };
                        if (!clean.includes('ayuda')) return { valid: false, msg: "El título debe ser 'Ayuda'." };
                        return { valid: true, msg: "¡Haz clic en 'Ayuda' en la previsualización!" };
                    }
                },
                quiz: {
                    q: "¿Qué etiqueta es visible siempre?",
                    options: ["<details>", "<summary>", "<content>"],
                    correct: 1
                }
            },
            {
                id: "a11y",
                title: "7. Accesibilidad",
                icon: "accessibility",
                content: `
                    <span class="text-brand-500 font-mono text-xs font-bold uppercase mb-2 block tracking-widest">Capítulo 7</span>
                    <h1 class="text-3xl md:text-4xl font-extrabold text-white mb-6">Web Inclusiva (ARIA)</h1>
                    <div class="prose prose-invert max-w-none text-slate-300">
                        <p>Los lectores de pantalla necesitan ayuda para entender botones que solo son iconos.</p>
                        <p class="mt-2">Usa <strong>aria-label</strong> para dar un nombre invisible pero audible.</p>
                    </div>
                `,
                codeRef: `<button aria-label="Cerrar ventana">X</button>`,
                exercise: {
                    instruction: "Crea un botón con el texto 'X' y un aria-label que diga 'Cerrar'.",
                    difficulty: "Intermedio",
                    validate: (code) => {
                        const doc = new DOMParser().parseFromString(code, "text/html");
                        const btn = doc.querySelector('button');
                        if (!btn) return { valid: false, msg: "Crea el <button>." };
                        if (btn.getAttribute('aria-label') !== 'Cerrar') return { valid: false, msg: "El aria-label debe ser 'Cerrar'." };
                        return { valid: true, msg: "¡Excelente accesibilidad!" };
                    }
                },
                quiz: {
                    q: "¿Para quién es útil aria-label?",
                    options: ["Lectores de pantalla", "Diseñadores", "Servidores"],
                    correct: 0
                }
            },
            {
                id: "responsive",
                title: "8. Responsive",
                icon: "image",
                content: `
                    <span class="text-brand-500 font-mono text-xs font-bold uppercase mb-2 block tracking-widest">Capítulo 8</span>
                    <h1 class="text-3xl md:text-4xl font-extrabold text-white mb-6">Imágenes Inteligentes</h1>
                    <div class="prose prose-invert max-w-none text-slate-300">
                        <p>La etiqueta <strong>&lt;picture&gt;</strong> permite cargar distintas imágenes según el tamaño de la pantalla.</p>
                    </div>
                `,
                codeRef: `<picture>
  <source media="(min-width: 800px)" srcset="grande.jpg">
  <img src="movil.jpg" alt="Foto">
</picture>`,
                exercise: {
                    instruction: "Crea un <picture> con un <source> y un <img>.",
                    difficulty: "Avanzado",
                    validate: (code) => {
                        const doc = new DOMParser().parseFromString(code, "text/html");
                        if (!doc.querySelector('picture')) return { valid: false, msg: "Falta <picture>." };
                        if (!doc.querySelector('source')) return { valid: false, msg: "Falta <source>." };
                        if (!doc.querySelector('img')) return { valid: false, msg: "Falta <img>." };
                        return { valid: true, msg: "¡Perfecto!" };
                    }
                },
                quiz: {
                    q: "¿Qué etiqueta se usa si el navegador no soporta picture?",
                    options: ["<source>", "<fallback>", "<img>"],
                    correct: 2
                }
            },
            // --- NUEVAS LECCIONES ---
            {
                id: "multimedia",
                title: "9. Multimedia Nativo",
                icon: "film",
                content: `
                    <span class="text-brand-500 font-mono text-xs font-bold uppercase mb-2 block tracking-widest">Capítulo 9</span>
                    <h1 class="text-3xl md:text-4xl font-extrabold text-white mb-6">Audio y Video</h1>
                    <div class="prose prose-invert max-w-none text-slate-300">
                        <p>HTML5 eliminó la necesidad de Flash. Ahora tenemos etiquetas nativas para reproducir medios.</p>
                        <div class="concept-box">
                            <h3 class="text-white font-bold mb-2">Etiquetas Clave</h3>
                            <ul class="list-disc pl-4 text-sm space-y-2">
                                <li><strong>&lt;audio&gt;</strong>: Para sonido.</li>
                                <li><strong>&lt;video&gt;</strong>: Para películas.</li>
                            </ul>
                        </div>
                        <p class="text-sm">El atributo mágico es <code>controls</code>, que añade automáticamente Play, Pausa y Volumen.</p>
                    </div>
                `,
                codeRef: `<!-- Video con controles -->
<video src="pelicula.mp4" controls width="300"></video>

<!-- Audio que se repite (loop) -->
<audio src="musica.mp3" controls loop></audio>`,
                exercise: {
                    instruction: "Crea una etiqueta <audio> que tenga el atributo 'controls' y 'src' apuntando a 'demo.mp3'.",
                    difficulty: "Intermedio",
                    validate: (code) => {
                        const doc = new DOMParser().parseFromString(code, "text/html");
                        const audio = doc.querySelector('audio');
                        if (!audio) return { valid: false, msg: "Necesitas la etiqueta <audio>." };
                        if (!audio.hasAttribute('controls')) return { valid: false, msg: "Falta el atributo 'controls' para ver los botones." };
                        if (!audio.getAttribute('src')) return { valid: false, msg: "Falta el atributo 'src' con el archivo." };
                        return { valid: true, msg: "¡Correcto! Verás el reproductor (aunque no sonará porque el archivo no existe)." };
                    }
                },
                quiz: {
                    q: "¿Qué atributo es necesario para que el usuario pueda dar Play/Pause?",
                    options: ["autoplay", "controls", "buttons"],
                    correct: 1
                }
            },
            {
                id: "canvas",
                title: "10. Canvas API",
                icon: "palette",
                content: `
                    <span class="text-brand-500 font-mono text-xs font-bold uppercase mb-2 block tracking-widest">Capítulo 10</span>
                    <h1 class="text-3xl md:text-4xl font-extrabold text-white mb-6">Dibujando con Píxeles</h1>
                    <div class="prose prose-invert max-w-none text-slate-300">
                        <p>A diferencia de SVG (vectores), <strong>&lt;canvas&gt;</strong> es un lienzo de píxeles controlado completamente por JavaScript.</p>
                        <p class="mt-2 text-sm">Es ideal para videojuegos, manipulación de fotos o gráficos complejos que cambian muy rápido.</p>
                    </div>
                `,
                codeRef: `<canvas id="miLienzo" width="200" height="100"></canvas>

<script>
  const c = document.getElementById("miLienzo");
  const ctx = c.getContext("2d");
  
  // Dibujar rectángulo rojo
  ctx.fillStyle = "red";
  ctx.fillRect(10, 10, 50, 50);
<\/script>`,
                exercise: {
                    instruction: "Crea un <canvas> con id='game' y usa JS para obtener su contexto '2d'.",
                    placeholder: "<canvas id='game'></canvas>\n<script>\n  const cvs = ...\n  const ctx = ...\n<\/script>",
                    difficulty: "Experto",
                    validate: (code) => {
                        if (!code.includes('<canvas')) return { valid: false, msg: "Falta la etiqueta <canvas>." };
                        if (!code.includes('getContext("2d")') && !code.includes("getContext('2d')")) return { valid: false, msg: "Debes obtener el contexto '2d' en JS." };
                        return { valid: true, msg: "¡Excelente! Has inicializado el motor gráfico de HTML5." };
                    }
                },
                quiz: {
                    q: "¿Qué método de JS se usa para empezar a dibujar en el canvas?",
                    options: ["getDrawing()", "getContext('2d')", "startCanvas()"],
                    correct: 1
                }
            }
        ];

        const progressStep = 100 / curriculum.length;

        // -------------------------------------------------------------------
        // 2. INICIALIZACIÓN Y PERSISTENCIA
        // -------------------------------------------------------------------

        document.addEventListener('DOMContentLoaded', () => {
            loadProgress();
            renderSidebar();
            loadLesson(state.currentIndex);
            setupTabSupport();
            lucide.createIcons();
        });

        function loadProgress() {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (saved) {
                try {
                    state = JSON.parse(saved);
                    if (state.currentIndex >= curriculum.length) state.currentIndex = 0;
                } catch (e) {
                    console.error("Error cargando progreso", e);
                }
            }
        }

        function saveProgress() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
        }

        function resetProgress() {
            if(confirm("¿Estás seguro de reiniciar todo el progreso?")) {
                localStorage.removeItem(STORAGE_KEY);
                location.reload();
            }
        }

        // -------------------------------------------------------------------
        // 3. UI: SIDEBAR Y TABULADOR
        // -------------------------------------------------------------------

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('mobile-overlay');
            sidebar.classList.toggle('-translate-x-full');
            
            if (sidebar.classList.contains('-translate-x-full')) {
                overlay.classList.remove('open');
            } else {
                overlay.classList.add('open');
            }
        }

        function renderSidebar() {
            const list = document.getElementById('module-list');
            list.innerHTML = curriculum.map((item, idx) => {
                const isCompleted = state.completedLessons.includes(idx);
                return `
                <button onclick="loadLesson(${idx})" 
                    class="nav-item w-full text-left px-5 py-3.5 flex items-center gap-3 text-sm font-medium text-slate-400 hover:text-slate-200 hover:bg-slate-800/50 transition-all border-l-2 border-transparent ${idx === state.currentIndex ? 'active' : ''}">
                    <i data-lucide="${item.icon}" class="w-4 h-4 shrink-0"></i>
                    <span class="truncate">${item.title}</span>
                    ${isCompleted ? '<i data-lucide="check-circle" class="ml-auto w-3.5 h-3.5 text-green-500 shrink-0"></i>' : ''}
                </button>
            `}).join('');
            lucide.createIcons();
        }

        function setupTabSupport() {
            const textarea = document.getElementById('code-input');
            textarea.addEventListener('keydown', function(e) {
                if (e.key == 'Tab') {
                    e.preventDefault();
                    var start = this.selectionStart;
                    var end = this.selectionEnd;
                    this.value = this.value.substring(0, start) + "  " + this.value.substring(end);
                    this.selectionStart = this.selectionEnd = start + 2;
                }
            });
        }

        // -------------------------------------------------------------------
        // 4. LOGICA DE LECCIONES
        // -------------------------------------------------------------------

        function loadLesson(index) {
            state.currentIndex = index;
            saveProgress();

            const data = curriculum[index];
            
            renderSidebar(); 
            
            if(window.innerWidth < 768) {
                document.getElementById('sidebar').classList.add('-translate-x-full');
                document.getElementById('mobile-overlay').classList.remove('open');
            }
            
            const contentDiv = document.getElementById('lesson-content');
            contentDiv.innerHTML = data.content;
            
            const codeRef = document.getElementById('reference-code');
            codeRef.innerHTML = syntaxHighlight(data.codeRef);
            
            updatePreview(data.codeRef);

            // Setup Exercise Area
            document.getElementById('workspace-area').classList.remove('hidden');
            document.getElementById('exercise-instruction').innerText = data.exercise.instruction;
            const codeInput = document.getElementById('code-input');
            codeInput.value = ""; 
            codeInput.placeholder = data.exercise.placeholder || "<!-- Tu código aquí -->";
            document.getElementById('difficulty-badge').innerText = data.exercise.difficulty;
            
            const fb = document.getElementById('feedback-msg');
            fb.style.opacity = '0';
            fb.innerText = '';
            document.getElementById('quiz-container').classList.add('hidden');
            
            document.getElementById('scroll-container').scrollTop = 0;

            updateProgressBar();
            lucide.createIcons();
        }

        function updatePreview(code) {
            const iframe = document.getElementById('preview-frame');
            const doc = iframe.contentDocument || iframe.contentWindow.document;
            
            const styles = `
                <style>
                    body { font-family: system-ui, sans-serif; padding: 20px; color: #333; } 
                    h1 { color: #0284c7; }
                    input { border: 1px solid #ccc; padding: 5px; border-radius: 4px; display: block; margin-bottom: 10px; width: 100%; box-sizing: border-box; }
                    button { background: #0284c7; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; }
                    button:hover { background: #0369a1; }
                    canvas, svg, video, audio { border: 2px dashed #0284c7; background: #f0f9ff; margin: 10px 0; max-width: 100%; }
                    details { border: 1px solid #ddd; padding: 10px; border-radius: 5px; cursor: pointer; margin-bottom: 10px; background: #fff; }
                    summary { font-weight: bold; color: #0284c7; margin-bottom: 5px; }
                    [role="alert"] { padding: 10px; background: #fee2e2; color: #b91c1c; border-radius: 4px; margin-top: 10px; border: 1px solid #fecaca; }
                </style>`;
            
            doc.open();
            doc.write(styles + code);
            doc.close();
        }

        // -------------------------------------------------------------------
        // 5. VALIDACIÓN Y QUIZ (Lógica Mejorada)
        // -------------------------------------------------------------------

        function validateCode() {
            const data = curriculum[state.currentIndex].exercise;
            const userCode = document.getElementById('code-input').value;
            
            updatePreview(userCode);

            const result = data.validate(userCode);
            const fb = document.getElementById('feedback-msg');
            
            fb.innerText = result.msg;
            fb.style.opacity = '1';
            
            if (result.valid) {
                fb.className = "w-full sm:w-auto text-xs font-bold px-3 py-2 rounded bg-green-500/20 text-green-400 border border-green-500/30 flex-1";
                setupQuiz(curriculum[state.currentIndex].quiz);
                confetti({ particleCount: 30, spread: 50, origin: { y: 0.7, x: 0.3 }, colors: ['#0ea5e9', '#22c55e'] });
            } else {
                fb.className = "w-full sm:w-auto text-xs font-bold px-3 py-2 rounded bg-red-500/20 text-red-400 border border-red-500/30 flex-1";
                const editor = document.querySelector('.code-editor-area');
                editor.classList.add('animate-pulse');
                setTimeout(() => editor.classList.remove('animate-pulse'), 500);
            }
        }

        function setupQuiz(quizData) {
            const container = document.getElementById('quiz-container');
            if(container.classList.contains('hidden')) {
                container.classList.remove('hidden');
                container.classList.add('animate-fade-in');
            }
            
            document.getElementById('quiz-question').innerText = quizData.q;
            
            // Generamos botones. Si la lección ya se completó antes, marcamos la correcta.
            const isDone = state.completedLessons.includes(state.currentIndex);

            document.getElementById('quiz-options').innerHTML = quizData.options.map((opt, i) => {
                let extraClass = "bg-slate-800 hover:bg-slate-700 text-slate-300 border-slate-700/50";
                let icon = "";
                let disabled = "";
                
                // Si ya estaba completa, mostrar el estado visual
                if (isDone) {
                    disabled = "disabled";
                    if (i === quizData.correct) {
                        extraClass = "bg-green-600 text-white border-green-400 opacity-80";
                        icon = '<i data-lucide="check" class="inline w-4 h-4 ml-2 float-right"></i>';
                    } else {
                        extraClass = "opacity-30 bg-slate-900";
                    }
                }

                return `
                <button onclick="checkQuiz(this, ${i}, ${quizData.correct})" ${disabled}
                    class="quiz-btn w-full text-left p-3 rounded text-sm transition-all border ${extraClass} mb-2">
                    <span class="font-bold text-brand-500 mr-2">${String.fromCharCode(65 + i)}.</span> ${opt} ${icon}
                </button>
            `}).join('');
            
            lucide.createIcons();
            setTimeout(() => {
                container.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }, 100);
        }

        function checkQuiz(btnElement, selected, correct) {
            const allBtns = document.querySelectorAll('.quiz-btn');

            if (selected === correct) {
                // CORRECTO
                btnElement.className = "quiz-btn w-full text-left p-3 rounded text-sm bg-green-600 text-white border border-green-400 shadow-[0_0_15px_rgba(34,197,94,0.4)] transition-all transform scale-[1.02] mb-2";
                btnElement.innerHTML += ' <i data-lucide="check" class="inline w-4 h-4 ml-2 float-right"></i>';
                
                // Deshabilitar todos
                allBtns.forEach(btn => btn.disabled = true);

                // Lógica de progreso
                if (!state.completedLessons.includes(state.currentIndex)) {
                    state.completedLessons.push(state.currentIndex);
                    saveProgress();
                }
                updateProgressBar(); // Esto habilitará el botón siguiente
                
                renderSidebar();
                lucide.createIcons();
                confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });

            } else {
                // INCORRECTO
                btnElement.className = "quiz-btn w-full text-left p-3 rounded text-sm bg-red-900/80 text-red-200 border border-red-500 animate-shake mb-2";
                btnElement.disabled = true; // Deshabilitar solo el incorrecto para que intenten otro
                
                // Feedback visual sutil en el botón incorrecto
                const badge = document.createElement('span');
                badge.innerText = " (Incorrecto)";
                badge.className = "text-[10px] ml-2 opacity-75";
                btnElement.appendChild(badge);
            }
        }

        function updateProgressBar() {
            const percentage = (state.completedLessons.length / curriculum.length) * 100;
            state.progress = percentage;
            
            document.getElementById('progress-bar').style.width = `${percentage}%`;
            document.getElementById('progress-text').innerText = `${Math.round(percentage)}%`;
            
            document.getElementById('btn-prev').disabled = state.currentIndex === 0;
            
            const nextBtn = document.getElementById('btn-next');
            // Si la lección está en la lista de completadas, activamos Next
            if (state.completedLessons.includes(state.currentIndex)) {
                nextBtn.disabled = false;
                nextBtn.classList.replace('bg-slate-700', 'bg-brand-600');
                nextBtn.classList.add('hover:bg-brand-500');
            } else {
                nextBtn.disabled = true;
                nextBtn.classList.replace('bg-brand-600', 'bg-slate-700');
                nextBtn.classList.remove('hover:bg-brand-500');
            }
        }

        function nextLesson() {
            if (state.currentIndex < curriculum.length - 1) {
                loadLesson(state.currentIndex + 1);
            } else {
                showCompletionModal();
            }
        }

        function prevLesson() {
            if (state.currentIndex > 0) {
                loadLesson(state.currentIndex - 1);
            }
        }

        // -------------------------------------------------------------------
        // 6. MODAL SYSTEM
        // -------------------------------------------------------------------

        function showCompletionModal() {
            confetti({ particleCount: 500, spread: 120, origin: { y: 0.6 } });
            const modal = document.getElementById('completion-modal');
            const content = document.getElementById('modal-content');
            
            modal.classList.remove('hidden');
            modal.classList.add('flex');
            
            setTimeout(() => {
                content.classList.remove('scale-95', 'opacity-0');
                content.classList.add('scale-100', 'opacity-100');
            }, 10);
        }

        function closeModal() {
            const modal = document.getElementById('completion-modal');
            modal.classList.add('hidden');
            modal.classList.remove('flex');
        }

        function syntaxHighlight(code) {
            return code
                .replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;')
                .replace(/(&lt;\/?)(\w+)(.*?)(&gt;)/g, (match, p1, p2, p3, p4) => {
                    const attrs = p3.replace(/(\w+)=(".*?")/g, '<span class="token-attr">$1</span>=<span class="token-val">$2</span>');
                    return `<span class="token-punct">${p1}</span><span class="token-tag">${p2}</span>${attrs}<span class="token-punct">${p4}</span>`;
                })
                .replace(/(&lt;!--.*?--&gt;)/g, '<span class="token-comment">$1</span>')
                .replace(/(var|let|const|document|localStorage|return)/g, '<span class="token-js">$1</span>');
        }

    </script>
</body>
</html>
