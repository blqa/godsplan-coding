<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTML5: Master Class Completa | Curso Interactivo</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Iconos Lucide -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Confetti -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            500: '#0ea5e9', // Sky blue
                            600: '#0284c7',
                            900: '#0c4a6e',
                        },
                        dark: {
                            bg: '#0f172a', // Slate 900
                            surface: '#1e293b', // Slate 800
                            border: '#334155', // Slate 700
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['Fira Code', 'monospace'],
                    }
                }
            }
        }
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Fira+Code:wght@400;500&display=swap');
        
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; color: #e2e8f0; }
        .font-mono { font-family: 'Fira Code', monospace; }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }

        /* Syntax Highlight Basics */
        .token-tag { color: #f472b6; } 
        .token-attr { color: #60a5fa; }
        .token-val { color: #a3e635; } 
        .token-comment { color: #64748b; font-style: italic; }
        .token-punct { color: #94a3b8; }

        .glass-panel {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(148, 163, 184, 0.1);
        }

        .code-editor-area {
            background-image: radial-gradient(#334155 1px, transparent 1px);
            background-size: 20px 20px;
        }

        /* Animaciones */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards; }

        .nav-item.active {
            background: linear-gradient(to right, rgba(14, 165, 233, 0.1), transparent);
            border-left: 3px solid #0ea5e9;
            color: #38bdf8;
        }
        
        textarea:focus { outline: none; }
    </style>
</head>
<body class="h-screen flex flex-col overflow-hidden">

    <!-- Header -->
    <header class="h-16 border-b border-dark-border bg-dark-bg/80 backdrop-blur-md flex items-center justify-between px-6 z-50 shrink-0">
        <div class="flex items-center gap-3">
            <div class="bg-gradient-to-tr from-brand-600 to-indigo-600 p-2 rounded-lg shadow-lg shadow-brand-500/20">
                <i data-lucide="book-open" class="text-white w-5 h-5"></i>
            </div>
            <div>
                <h1 class="font-bold text-white tracking-tight leading-tight">Master HTML5</h1>
                <p class="text-[10px] text-slate-400 font-medium uppercase tracking-wider">Edición Completa</p>
            </div>
        </div>

        <div class="flex items-center gap-6">
            <div class="flex flex-col items-end">
                <div class="flex items-center gap-2 text-xs font-semibold uppercase text-slate-400 mb-1.5">
                    <span>Progreso</span>
                    <span id="progress-text" class="text-brand-500">0%</span>
                </div>
                <div class="w-32 h-1.5 bg-slate-800 rounded-full overflow-hidden">
                    <div id="progress-bar" class="h-full bg-brand-500 w-0 transition-all duration-700 ease-out"></div>
                </div>
            </div>
        </div>
    </header>

    <!-- Layout Principal -->
    <div class="flex-1 flex overflow-hidden">
        
        <!-- Sidebar -->
        <aside class="w-72 bg-dark-bg border-r border-dark-border flex flex-col shrink-0 transition-all duration-300 absolute md:relative z-40 h-full -translate-x-full md:translate-x-0" id="sidebar">
            <div class="p-4 border-b border-dark-border bg-dark-surface/30">
                <h2 class="text-xs font-bold text-slate-500 uppercase tracking-widest">Índice del Curso</h2>
            </div>
            <nav id="module-list" class="flex-1 overflow-y-auto py-2 space-y-0.5">
                <!-- Se llena con JS -->
            </nav>
            
            <!-- User Profile footer -->
            <div class="p-4 border-t border-dark-border mt-auto">
                <div class="flex items-center gap-3">
                    <div class="w-8 h-8 rounded-full bg-gradient-to-r from-purple-500 to-pink-500 flex items-center justify-center text-xs font-bold text-white">
                        DEV
                    </div>
                    <div>
                        <div class="text-sm font-medium text-white">Estudiante</div>
                        <div class="text-xs text-slate-500">Modo Aprendizaje</div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="flex-1 flex flex-col lg:flex-row min-w-0 bg-dark-bg relative">
            
            <!-- Mobile Toggle -->
            <button onclick="document.getElementById('sidebar').classList.toggle('-translate-x-full')" class="md:hidden absolute top-4 left-4 z-50 p-2 bg-brand-600 rounded shadow-lg text-white">
                <i data-lucide="menu" class="w-5 h-5"></i>
            </button>

            <!-- Left: Theory & Exercise -->
            <section class="flex-1 overflow-y-auto scroll-smooth custom-scrollbar relative" id="scroll-container">
                <div class="max-w-3xl mx-auto p-6 lg:p-12 pb-32">
                    
                    <!-- Content Injection -->
                    <div id="lesson-content" class="animate-fade-in mb-12"></div>

                    <!-- Interactive Workspace -->
                    <div id="workspace-area" class="hidden animate-fade-in space-y-8">
                        
                        <!-- Exercise Card -->
                        <div class="rounded-xl overflow-hidden border border-brand-500/30 shadow-2xl shadow-brand-900/20 bg-[#162032]">
                            <!-- Toolbar -->
                            <div class="bg-[#1e293b] px-4 py-3 flex justify-between items-center border-b border-slate-700">
                                <div class="flex items-center gap-2">
                                    <i data-lucide="code-2" class="w-4 h-4 text-brand-400"></i>
                                    <span class="text-xs font-bold text-slate-300 uppercase tracking-wider">Editor de Desafíos</span>
                                </div>
                                <span id="difficulty-badge" class="px-2 py-0.5 rounded text-[10px] font-bold bg-slate-700 text-slate-300 uppercase border border-slate-600">
                                    Básico
                                </span>
                            </div>

                            <!-- Instructions -->
                            <div class="bg-gradient-to-b from-[#1e293b] to-[#162032] p-5 border-b border-slate-800">
                                <h3 class="text-white font-semibold mb-2 flex items-center gap-2">
                                    <i data-lucide="terminal" class="w-4 h-4 text-yellow-500"></i>
                                    Instrucción:
                                </h3>
                                <p id="exercise-instruction" class="text-slate-300 text-sm leading-relaxed"></p>
                            </div>

                            <!-- Code Input -->
                            <div class="relative code-editor-area">
                                <div class="absolute top-3 right-3 text-[10px] text-slate-500 font-mono pointer-events-none">HTML</div>
                                <textarea id="code-input" spellcheck="false" 
                                    class="w-full h-40 bg-transparent p-5 font-mono text-sm text-slate-200 resize-y border-none focus:ring-0 leading-relaxed"
                                    placeholder="<!-- Escribe tu código aquí... -->"></textarea>
                            </div>

                            <!-- Action Bar -->
                            <div class="p-4 bg-[#1e293b] border-t border-slate-700 flex justify-between items-center">
                                <div id="feedback-msg" class="text-xs font-medium px-3 py-1.5 rounded transition-all opacity-0"></div>
                                <button onclick="validateCode()" class="group relative px-5 py-2 bg-brand-600 hover:bg-brand-500 text-white text-sm font-semibold rounded-lg shadow-lg shadow-brand-600/20 transition-all flex items-center gap-2 overflow-hidden">
                                    <div class="absolute inset-0 w-full h-full bg-white/20 translate-y-full group-hover:translate-y-0 transition-transform duration-300"></div>
                                    <span class="relative z-10 flex items-center gap-2">
                                        <i data-lucide="play" class="w-4 h-4 fill-current"></i> Verificar Código
                                    </span>
                                </button>
                            </div>
                        </div>

                        <!-- Quiz Section (Hidden initially) -->
                        <div id="quiz-container" class="hidden bg-slate-800/50 border border-slate-700 rounded-xl p-6 backdrop-blur-sm">
                            <div class="flex items-start gap-4">
                                <div class="w-10 h-10 rounded-full bg-purple-500/20 flex items-center justify-center shrink-0 text-purple-400">
                                    <i data-lucide="help-circle" class="w-6 h-6"></i>
                                </div>
                                <div class="flex-1">
                                    <h3 class="text-lg font-bold text-white mb-2">Pregunta Rápida</h3>
                                    <p id="quiz-question" class="text-slate-300 mb-4 text-sm"></p>
                                    <div id="quiz-options" class="space-y-2"></div>
                                </div>
                            </div>
                        </div>

                    </div>

                    <!-- Navigation -->
                    <div class="mt-12 flex justify-between items-center pt-8 border-t border-slate-800">
                        <button onclick="prevLesson()" id="btn-prev" class="px-4 py-2 text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg transition-colors flex items-center gap-2 text-sm font-medium disabled:opacity-30 disabled:pointer-events-none">
                            <i data-lucide="arrow-left" class="w-4 h-4"></i> Anterior
                        </button>
                        <button onclick="nextLesson()" id="btn-next" class="px-6 py-2.5 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-all flex items-center gap-2 text-sm font-bold shadow-lg disabled:opacity-50 disabled:cursor-not-allowed">
                            Siguiente <i data-lucide="arrow-right" class="w-4 h-4"></i>
                        </button>
                    </div>

                </div>
            </section>

            <!-- Right: Live Preview & Code Reference -->
            <section class="hidden lg:flex w-[45%] xl:w-[40%] flex-col border-l border-dark-border bg-[#0b1120] relative z-10">
                
                <!-- Tab Header -->
                <div class="h-10 bg-dark-bg border-b border-dark-border flex items-end px-2 gap-1">
                    <div class="px-4 py-2 bg-[#1e293b] text-blue-400 text-xs font-mono border-t-2 border-blue-500 rounded-t-md flex items-center gap-2">
                        <i data-lucide="file-code" class="w-3 h-3"></i> index.html
                    </div>
                    <div class="ml-auto flex items-center px-3 py-2 gap-2">
                        <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                        <span class="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Live Preview</span>
                    </div>
                </div>

                <!-- Read-only Code View -->
                <div class="h-1/2 overflow-hidden bg-[#1e293b] border-b-4 border-dark-bg flex flex-col">
                    <div class="flex justify-between items-center px-4 py-2 border-b border-slate-700/50 bg-[#1e293b]">
                        <span class="text-[10px] text-slate-500 font-bold uppercase">Código de Referencia</span>
                    </div>
                    <pre id="reference-code" class="flex-1 p-5 font-mono text-xs md:text-sm text-slate-300 overflow-auto custom-scrollbar"></pre>
                </div>

                <!-- Browser Preview -->
                <div class="h-1/2 flex flex-col bg-white">
                    <div class="h-8 bg-slate-100 border-b border-slate-200 flex items-center px-3 gap-2 shrink-0">
                        <div class="flex gap-1.5">
                            <div class="w-2.5 h-2.5 rounded-full bg-slate-300"></div>
                            <div class="w-2.5 h-2.5 rounded-full bg-slate-300"></div>
                        </div>
                        <div class="flex-1 bg-white h-5 rounded border border-slate-200 flex items-center px-2">
                            <i data-lucide="lock" class="w-2.5 h-2.5 text-slate-400 mr-1.5"></i>
                            <span class="text-[9px] text-slate-400 font-sans">localhost:8080</span>
                        </div>
                    </div>
                    <iframe id="preview-frame" class="flex-1 w-full border-none bg-white"></iframe>
                </div>
            </section>
        </main>
    </div>

    <!-- Data & Logic -->
    <script>
        // -------------------------------------------------------------------
        // BASE DE CONOCIMIENTO (Actualizada)
        // -------------------------------------------------------------------
        
        const curriculum = [
            {
                id: "intro",
                title: "1. Estructura Global",
                icon: "layout",
                content: `
                    <span class="text-brand-500 font-mono text-xs font-bold uppercase mb-2 block tracking-widest">Capítulo 1</span>
                    <h1 class="text-3xl md:text-4xl font-extrabold text-white mb-6">El Documento HTML5</h1>
                    <div class="prose prose-invert max-w-none text-slate-300">
                        <p>Según Gauchat, HTML5 no es solo nuevas etiquetas, es una nueva forma de estructurar la web. Todo comienza con una declaración simplificada.</p>
                        <ul class="list-disc pl-5 space-y-2 mb-6 text-sm">
                            <li><strong>DOCTYPE:</strong> En HTML5 es simplemente <code>&lt;!DOCTYPE html&gt;</code>.</li>
                            <li><strong>Charset:</strong> Definir <code>&lt;meta charset="utf-8"&gt;</code> es vital.</li>
                            <li><strong>Lang:</strong> Siempre define el idioma en la etiqueta <code>html</code>.</li>
                        </ul>
                    </div>
                `,
                codeRef: `<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <title>Mi Primera Web HTML5</title>
</head>
<body>
    <h1>Hola Mundo</h1>
</body>
</html>`,
                exercise: {
                    instruction: "Escribe la estructura mínima de un documento HTML5. Asegúrate de incluir el DOCTYPE, la etiqueta html con lang='es' y un título.",
                    placeholder: "<!DOCTYPE html>\n...",
                    difficulty: "Básico",
                    validate: (code) => {
                        const clean = code.toLowerCase().replace(/\s+/g, '');
                        if (!clean.includes('<!doctypehtml>')) return { valid: false, msg: "Falta la declaración <!DOCTYPE html> al inicio." };
                        if (!clean.includes('<htmllang="es">') && !clean.includes("<htmllang='es'>")) return { valid: false, msg: "La etiqueta html debe tener el atributo lang='es'." };
                        if (!clean.includes('<title>')) return { valid: false, msg: "No olvides la etiqueta <title> dentro del head." };
                        return { valid: true, msg: "¡Estructura perfecta!" };
                    }
                },
                quiz: {
                    q: "¿Por qué se simplificó el DOCTYPE en HTML5?",
                    options: ["Para que cargue más rápido", "Porque HTML5 ya no está basado en SGML", "Para ahorrar bytes"],
                    correct: 1
                }
            },
            {
                id: "semantics",
                title: "2. Semántica Estructural",
                icon: "columns",
                content: `
                    <span class="text-brand-500 font-mono text-xs font-bold uppercase mb-2 block tracking-widest">Capítulo 2</span>
                    <h1 class="text-3xl md:text-4xl font-extrabold text-white mb-6">Adiós al &lt;div&gt; Soup</h1>
                    <div class="prose prose-invert max-w-none text-slate-300">
                        <p>Una de las premisas del libro es dar significado al contenido. HTML5 introduce etiquetas con significado semántico:</p>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 my-6 text-sm">
                            <div class="bg-slate-800 p-3 rounded border border-slate-700"><code class="text-pink-400 font-bold">&lt;header&gt;</code><p class="mt-1 text-slate-400">Cabecera, logos.</p></div>
                            <div class="bg-slate-800 p-3 rounded border border-slate-700"><code class="text-pink-400 font-bold">&lt;nav&gt;</code><p class="mt-1 text-slate-400">Navegación principal.</p></div>
                            <div class="bg-slate-800 p-3 rounded border border-slate-700"><code class="text-pink-400 font-bold">&lt;section&gt;</code><p class="mt-1 text-slate-400">Agrupación temática.</p></div>
                            <div class="bg-slate-800 p-3 rounded border border-slate-700"><code class="text-pink-400 font-bold">&lt;footer&gt;</code><p class="mt-1 text-slate-400">Pie de página.</p></div>
                        </div>
                    </div>
                `,
                codeRef: `<header>
    <h1>Mi Blog</h1>
    <nav>
        <a href="#">Inicio</a>
    </nav>
</header>
<section>
    <h2>Último post</h2>
    <p>Contenido...</p>
</section>
<footer><p>&copy; 2024</p></footer>`,
                exercise: {
                    instruction: "Crea una barra de navegación semántica. Usa la etiqueta <nav> y dentro coloca dos enlaces <a>.",
                    difficulty: "Intermedio",
                    validate: (code) => {
                        const parser = new DOMParser();
                        const doc = parser.parseFromString(code, "text/html");
                        const nav = doc.querySelector('nav');
                        if (!nav) return { valid: false, msg: "No encontré la etiqueta <nav>." };
                        if (nav.querySelectorAll('a').length < 2) return { valid: false, msg: "Debes incluir al menos dos enlaces <a> dentro del <nav>." };
                        return { valid: true, msg: "¡Excelente uso de la semántica!" };
                    }
                },
                quiz: {
                    q: "¿Qué etiqueta usarías para un artículo de blog independiente?",
                    options: ["<section>", "<article>", "<div>"],
                    correct: 1
                }
            },
            {
                id: "forms",
                title: "3. Formularios 2.0",
                icon: "check-square",
                content: `
                    <span class="text-brand-500 font-mono text-xs font-bold uppercase mb-2 block tracking-widest">Capítulo 3</span>
                    <h1 class="text-3xl md:text-4xl font-extrabold text-white mb-6">Formularios Inteligentes</h1>
                    <div class="prose prose-invert max-w-none text-slate-300">
                        <p>Nuevos tipos de input esenciales que validan automáticamente:</p>
                        <ul class="space-y-2 text-sm mb-6">
                            <li><code class="text-yellow-300">type="email"</code>: Valida formato de correo.</li>
                            <li><code class="text-yellow-300">type="date"</code>: Despliega un calendario.</li>
                            <li><code class="text-yellow-300">required</code>: Campo obligatorio.</li>
                            <li><code class="text-yellow-300">placeholder</code>: Texto de ayuda.</li>
                        </ul>
                    </div>
                `,
                codeRef: `<form>
    <label>Email:</label>
    <input type="email" required placeholder="tu@email.com">
    <input type="date">
    <button type="submit">Enviar</button>
</form>`,
                exercise: {
                    instruction: "Crea un input para email que sea obligatorio (required) y tenga placeholder 'usuario@web.com'.",
                    difficulty: "Intermedio",
                    validate: (code) => {
                        const parser = new DOMParser();
                        const doc = parser.parseFromString(code, "text/html");
                        const input = doc.querySelector('input');
                        if (!input) return { valid: false, msg: "Falta la etiqueta <input>." };
                        if (input.getAttribute('type') !== 'email') return { valid: false, msg: "El tipo debe ser 'email'." };
                        if (!input.hasAttribute('required')) return { valid: false, msg: "Falta el atributo 'required'." };
                        if (input.getAttribute('placeholder') !== 'usuario@web.com') return { valid: false, msg: "El placeholder debe ser exactamente 'usuario@web.com'." };
                        return { valid: true, msg: "¡Correcto! Validación nativa activa." };
                    }
                },
                quiz: {
                    q: "¿Qué atributo muestra un texto gris de ayuda?",
                    options: ["value", "helper", "placeholder"],
                    correct: 2
                }
            },
            {
                id: "multimedia",
                title: "4. Audio y Video",
                icon: "play-circle",
                content: `
                    <span class="text-brand-500 font-mono text-xs font-bold uppercase mb-2 block tracking-widest">Capítulo 4</span>
                    <h1 class="text-3xl md:text-4xl font-extrabold text-white mb-6">Multimedia Sin Plugins</h1>
                    <div class="prose prose-invert max-w-none text-slate-300">
                        <p>Adiós Flash. HTML5 introduce etiquetas nativas.</p>
                        <ul class="list-disc pl-5 space-y-1 text-sm mb-4">
                            <li><strong>controls:</strong> Muestra la UI del reproductor.</li>
                            <li><strong>poster:</strong> Imagen de portada.</li>
                        </ul>
                    </div>
                `,
                codeRef: `<video controls width="300" poster="portada.jpg">
    <source src="video.mp4" type="video/mp4">
    <p>Tu navegador no soporta video.</p>
</video>`,
                exercise: {
                    instruction: "Inserta un <video> con controles y ancho de 400.",
                    difficulty: "Avanzado",
                    validate: (code) => {
                        const parser = new DOMParser();
                        const doc = parser.parseFromString(code, "text/html");
                        const video = doc.querySelector('video');
                        if (!video) return { valid: false, msg: "Falta la etiqueta <video>." };
                        if (!video.hasAttribute('controls')) return { valid: false, msg: "Faltan los 'controls'." };
                        if (video.getAttribute('width') !== '400') return { valid: false, msg: "El ancho debe ser 400." };
                        return { valid: true, msg: "¡Perfecto! Video nativo listo." };
                    }
                },
                quiz: {
                    q: "¿Qué etiqueta define múltiples formatos dentro de video?",
                    options: ["<track>", "<source>", "<file>"],
                    correct: 1
                }
            },
            // --- NUEVOS MÓDULOS ---
            {
                id: "canvas",
                title: "5. Gráficos (Canvas)",
                icon: "palette",
                content: `
                    <span class="text-brand-500 font-mono text-xs font-bold uppercase mb-2 block tracking-widest">Capítulo 5</span>
                    <h1 class="text-3xl md:text-4xl font-extrabold text-white mb-6">Dibujando con Code</h1>
                    <div class="prose prose-invert max-w-none text-slate-300">
                        <p>El elemento <code>&lt;canvas&gt;</code> es un lienzo en blanco para dibujar gráficos vía JavaScript (2D o 3D).</p>
                        <p class="mb-4">Pasos:</p>
                        <ol class="list-decimal pl-5 space-y-2 mb-6 text-sm">
                            <li>Crear la etiqueta con <code>id</code>, <code>width</code> y <code>height</code>.</li>
                            <li>Usar JS: <code>getContext('2d')</code>.</li>
                            <li>Dibujar: <code>fillRect()</code>, <code>beginPath()</code>.</li>
                        </ol>
                    </div>
                `,
                codeRef: `<canvas id="miLienzo" width="200" height="100"></canvas>
<script>
  var c = document.getElementById("miLienzo");
  var ctx = c.getContext("2d");
  ctx.fillStyle = "#FF0000";
  ctx.fillRect(10, 10, 80, 80);
<\/script>`,
                exercise: {
                    instruction: "Crea un <canvas> con id='game-area', width='300' y height='200'.",
                    placeholder: '<canvas id="..." ...></canvas>',
                    difficulty: "Intermedio",
                    validate: (code) => {
                        const parser = new DOMParser();
                        const doc = parser.parseFromString(code, "text/html");
                        const canvas = doc.querySelector('canvas');

                        if (!canvas) return { valid: false, msg: "Falta la etiqueta <canvas>." };
                        if (canvas.id !== 'game-area') return { valid: false, msg: "El id debe ser 'game-area'." };
                        if (canvas.getAttribute('width') !== '300') return { valid: false, msg: "El ancho debe ser 300." };
                        if (canvas.getAttribute('height') !== '200') return { valid: false, msg: "El alto debe ser 200." };

                        // MAGIC: Auto-paint to show it works
                        const iframe = document.getElementById('preview-frame');
                        const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                        // Inject script to paint immediately
                        const script = iframeDoc.createElement('script');
                        script.textContent = `
                            var c = document.getElementById("game-area");
                            if(c) {
                                var ctx = c.getContext("2d");
                                ctx.fillStyle = "#0ea5e9";
                                ctx.fillRect(50, 50, 200, 100);
                                ctx.font = "20px Arial";
                                ctx.fillStyle = "white";
                                ctx.fillText("¡Canvas Activo!", 80, 110);
                            }
                        `;
                        iframeDoc.body.appendChild(script);

                        return { valid: true, msg: "¡Lienzo preparado! He dibujado algo azul con JS para probarlo." };
                    }
                },
                quiz: {
                    q: "¿Qué método de JS inicia el dibujo?",
                    options: ["getDrawingArea()", "getContext('2d')", "createGraphics()"],
                    correct: 1
                }
            },
            {
                id: "details",
                title: "6. Interactividad",
                icon: "layers",
                content: `
                    <span class="text-brand-500 font-mono text-xs font-bold uppercase mb-2 block tracking-widest">Capítulo 6</span>
                    <h1 class="text-3xl md:text-4xl font-extrabold text-white mb-6">Acordeones Nativos</h1>
                    <div class="prose prose-invert max-w-none text-slate-300">
                        <p>HTML5 trajo widgets interactivos sin necesidad de librerías JS.</p>
                        <ul class="list-disc pl-5 space-y-2 mb-6 text-sm">
                            <li><strong>&lt;details&gt;:</strong> Contenedor que se abre/cierra.</li>
                            <li><strong>&lt;summary&gt;:</strong> El título visible donde haces clic.</li>
                        </ul>
                    </div>
                `,
                codeRef: `<details>
  <summary>¿Más info?</summary>
  <p>Texto oculto que aparece al clic.</p>
</details>`,
                exercise: {
                    instruction: "Crea un acordeón con <details>. El <summary> debe decir 'Ayuda' y dentro pon un párrafo cualquiera.",
                    difficulty: "Fácil",
                    validate: (code) => {
                        const clean = code.toLowerCase();
                        if (!clean.includes('<details>')) return { valid: false, msg: "Falta <details>." };
                        if (!clean.includes('<summary>')) return { valid: false, msg: "Falta <summary>." };
                        if (!clean.includes('ayuda')) return { valid: false, msg: "El summary debe decir 'Ayuda'." };
                        return { valid: true, msg: "¡Funciona! Pruébalo en la previsualización." };
                    }
                },
                quiz: {
                    q: "¿Qué etiqueta es visible siempre en un details?",
                    options: ["<title>", "<header>", "<summary>"],
                    correct: 2
                }
            },
            {
                id: "responsive",
                title: "7. Imágenes Responsive",
                icon: "image",
                content: `
                    <span class="text-brand-500 font-mono text-xs font-bold uppercase mb-2 block tracking-widest">Capítulo 7</span>
                    <h1 class="text-3xl md:text-4xl font-extrabold text-white mb-6">Etiqueta &lt;picture&gt;</h1>
                    <div class="prose prose-invert max-w-none text-slate-300">
                        <p>Permite servir diferentes imágenes según el tamaño de pantalla del dispositivo, ahorrando datos en móviles.</p>
                        <p>Se usa <code>&lt;picture&gt;</code> envolviendo varios <code>&lt;source&gt;</code> y un <code>&lt;img&gt;</code> final como fallback.</p>
                    </div>
                `,
                codeRef: `<picture>
  <source media="(min-width: 650px)" srcset="grande.jpg">
  <source media="(min-width: 465px)" srcset="mediana.jpg">
  <img src="pequeña.jpg" alt="Descripción">
</picture>`,
                exercise: {
                    instruction: "Escribe una estructura <picture> que contenga al menos un <source> y una imagen <img> obligatoria al final.",
                    difficulty: "Avanzado",
                    validate: (code) => {
                        const parser = new DOMParser();
                        const doc = parser.parseFromString(code, "text/html");
                        if (!doc.querySelector('picture')) return { valid: false, msg: "Falta <picture>." };
                        if (!doc.querySelector('source')) return { valid: false, msg: "Falta al menos un <source>." };
                        if (!doc.querySelector('img')) return { valid: false, msg: "Siempre debes incluir un <img> al final como fallback." };
                        return { valid: true, msg: "¡Excelente! Tus imágenes ahora se adaptan." };
                    }
                },
                quiz: {
                    q: "¿Qué etiqueta se carga si el navegador no soporta picture?",
                    options: ["<fallback>", "<img>", "<source>"],
                    correct: 1
                }
            }
        ];

        // -------------------------------------------------------------------
        // LÓGICA DE LA APLICACIÓN
        // -------------------------------------------------------------------

        let currentIndex = 0;
        let progress = 0;
        const progressStep = 100 / curriculum.length;

        // Init
        document.addEventListener('DOMContentLoaded', () => {
            renderSidebar();
            loadLesson(0);
            lucide.createIcons();
        });

        function renderSidebar() {
            const list = document.getElementById('module-list');
            list.innerHTML = curriculum.map((item, idx) => `
                <button onclick="loadLesson(${idx})" 
                    class="nav-item w-full text-left px-5 py-3.5 flex items-center gap-3 text-sm font-medium text-slate-400 hover:text-slate-200 hover:bg-slate-800/50 transition-all border-l-2 border-transparent ${idx === currentIndex ? 'active' : ''}">
                    <i data-lucide="${item.icon}" class="w-4 h-4"></i>
                    ${item.title}
                    ${idx < currentIndex ? '<i data-lucide="check" class="ml-auto w-3 h-3 text-green-500"></i>' : ''}
                </button>
            `).join('');
            lucide.createIcons();
        }

        function loadLesson(index) {
            currentIndex = index;
            const data = curriculum[index];
            
            // UI Updates
            renderSidebar(); 
            
            // Content
            const contentDiv = document.getElementById('lesson-content');
            contentDiv.innerHTML = data.content;
            
            // Code Reference
            const codeRef = document.getElementById('reference-code');
            codeRef.innerHTML = syntaxHighlight(data.codeRef);
            
            // Preview
            const iframe = document.getElementById('preview-frame');
            const doc = iframe.contentDocument || iframe.contentWindow.document;
            doc.open();
            doc.write(`
                <style>
                    body { font-family: system-ui, sans-serif; padding: 20px; color: #333; } 
                    h1 { color: #0284c7; }
                    input { border: 1px solid #ccc; padding: 5px; border-radius: 4px; display: block; margin-bottom: 10px; width: 100%; }
                    button { background: #0284c7; color: white; border: none; padding: 8px 16px; border-radius: 4px; }
                    canvas { border: 2px dashed #ccc; background: #f8fafc; }
                    details { border: 1px solid #ddd; padding: 10px; border-radius: 5px; cursor: pointer; }
                    summary { font-weight: bold; color: #0284c7; outline: none; }
                </style>
                ${data.codeRef}
            `);
            doc.close();

            // Exercise Setup
            document.getElementById('workspace-area').classList.remove('hidden');
            document.getElementById('exercise-instruction').innerText = data.exercise.instruction;
            document.getElementById('code-input').value = ""; 
            document.getElementById('code-input').placeholder = data.exercise.placeholder || "<!-- Tu código aquí -->";
            document.getElementById('difficulty-badge').innerText = data.exercise.difficulty;
            
            // Reset Feedback & Quiz
            const fb = document.getElementById('feedback-msg');
            fb.style.opacity = '0';
            document.getElementById('quiz-container').classList.add('hidden');
            
            // Scroll to top
            document.getElementById('scroll-container').scrollTop = 0;

            updateProgress();
            lucide.createIcons();
        }

        function validateCode() {
            const data = curriculum[currentIndex].exercise;
            const userCode = document.getElementById('code-input').value;
            
            // Update Preview with User Code First
            const iframe = document.getElementById('preview-frame');
            const doc = iframe.contentDocument || iframe.contentWindow.document;
            
            // Preserve styles, replace body
            const styles = `
                <style>
                    body { font-family: system-ui, sans-serif; padding: 20px; color: #333; } 
                    h1 { color: #0284c7; }
                    input { border: 1px solid #ccc; padding: 5px; border-radius: 4px; display: block; margin-bottom: 10px; width: 100%; }
                    button { background: #0284c7; color: white; border: none; padding: 8px 16px; border-radius: 4px; }
                    canvas { border: 2px dashed #0284c7; background: #f0f9ff; }
                    details { border: 1px solid #ddd; padding: 10px; border-radius: 5px; cursor: pointer; margin-bottom: 10px; }
                    summary { font-weight: bold; color: #0284c7; }
                </style>`;
            
            doc.open();
            doc.write(styles + userCode);
            doc.close();

            // Validate
            const result = data.validate(userCode);
            const fb = document.getElementById('feedback-msg');
            
            fb.innerText = result.msg;
            fb.style.opacity = '1';
            
            if (result.valid) {
                fb.className = "text-xs font-bold px-3 py-2 rounded bg-green-500/20 text-green-400 border border-green-500/30 flex-1 mr-4";
                setupQuiz(curriculum[currentIndex].quiz);
                confetti({ particleCount: 30, spread: 50, origin: { y: 0.7, x: 0.3 }, colors: ['#0ea5e9', '#22c55e'] });
            } else {
                fb.className = "text-xs font-bold px-3 py-2 rounded bg-red-500/20 text-red-400 border border-red-500/30 flex-1 mr-4";
                const editor = document.querySelector('.code-editor-area');
                editor.classList.add('animate-pulse');
                setTimeout(() => editor.classList.remove('animate-pulse'), 500);
            }
        }

        function setupQuiz(quizData) {
            const container = document.getElementById('quiz-container');
            container.classList.remove('hidden');
            container.classList.add('animate-fade-in');
            
            document.getElementById('quiz-question').innerText = quizData.q;
            document.getElementById('quiz-options').innerHTML = quizData.options.map((opt, i) => `
                <button onclick="checkQuiz(${i}, ${quizData.correct})" class="w-full text-left p-2 rounded text-sm text-slate-400 hover:bg-slate-700 hover:text-white transition-colors border border-transparent hover:border-slate-600">
                    ${String.fromCharCode(65 + i)}. ${opt}
                </button>
            `).join('');
            
            setTimeout(() => {
                container.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }, 300);
        }

        function checkQuiz(selected, correct) {
            const buttons = document.querySelectorAll('#quiz-options button');
            
            if (selected === correct) {
                buttons[selected].classList.add('bg-green-600', 'text-white', '!border-green-400');
                buttons[selected].innerHTML += ' <i data-lucide="check" class="inline w-3 h-3 ml-2"></i>';
                
                document.getElementById('btn-next').disabled = false;
                document.getElementById('btn-next').classList.replace('bg-slate-700', 'bg-brand-600');
                
                if (progress < ((currentIndex + 1) * progressStep)) {
                    progress = (currentIndex + 1) * progressStep;
                    updateProgress();
                }
                
                confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });

            } else {
                buttons[selected].classList.add('bg-red-900/50', 'text-red-300', '!border-red-500/50');
            }
            lucide.createIcons();
        }

        function updateProgress() {
            document.getElementById('progress-bar').style.width = `${progress}%`;
            document.getElementById('progress-text').innerText = `${Math.round(progress)}%`;
            
            document.getElementById('btn-prev').disabled = currentIndex === 0;
            
            const nextBtn = document.getElementById('btn-next');
            if (currentIndex === 0 && progress === 0) {
                 nextBtn.disabled = true;
                 nextBtn.classList.replace('bg-brand-600', 'bg-slate-700');
            }
        }

        function nextLesson() {
            if (currentIndex < curriculum.length - 1) {
                loadLesson(currentIndex + 1);
            } else {
                confetti({ particleCount: 300, spread: 100, origin: { y: 0.5 } });
                alert("¡Curso Maestro HTML5 Completado!");
            }
        }

        function prevLesson() {
            if (currentIndex > 0) {
                loadLesson(currentIndex - 1);
                const nextBtn = document.getElementById('btn-next');
                nextBtn.disabled = false;
                nextBtn.classList.replace('bg-slate-700', 'bg-brand-600');
            }
        }

        function syntaxHighlight(code) {
            return code
                .replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;')
                .replace(/(&lt;\/?)(\w+)(.*?)(&gt;)/g, (match, p1, p2, p3, p4) => {
                    const attrs = p3.replace(/(\w+)=(".*?")/g, '<span class="token-attr">$1</span>=<span class="token-val">$2</span>');
                    return `<span class="token-punct">${p1}</span><span class="token-tag">${p2}</span>${attrs}<span class="token-punct">${p4}</span>`;
                })
                .replace(/(&lt;!--.*?--&gt;)/g, '<span class="token-comment">$1</span>');
        }

    </script>
</body>
</html>
