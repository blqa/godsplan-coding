<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GodsPlan | SQL Master Course</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Iconos Lucide -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Confetti -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        neutral: {
                            850: '#171717',
                            900: '#0a0a0a',
                            950: '#000000',
                        },
                        red: {
                            400: '#f87171',
                            500: '#ef4444',
                            600: '#dc2626',
                            900: '#7f1d1d',
                        },
                        purple: { 
                            400: '#c084fc', // SQL Purple Accent
                            500: '#a855f7',
                            600: '#9333ea',
                            900: '#581c87',
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['Fira Code', 'monospace'],
                    },
                    animation: {
                        'pulse-glow': 'pulse-glow 2s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'shake': 'shake 0.5s cubic-bezier(.36,.07,.19,.97) both',
                        'slide-down': 'slideDown 0.3s ease-out forwards',
                        'blink': 'blink 1s step-end infinite',
                    },
                    keyframes: {
                        'pulse-glow': {
                            '0%, 100%': { opacity: 1, boxShadow: '0 0 10px rgba(168, 85, 247, 0.5)' },
                            '50%': { opacity: .5, boxShadow: '0 0 20px rgba(168, 85, 247, 0.1)' },
                        },
                        shake: {
                            '10%, 90%': { transform: 'translate3d(-1px, 0, 0)' },
                            '20%, 80%': { transform: 'translate3d(2px, 0, 0)' },
                            '30%, 50%, 70%': { transform: 'translate3d(-4px, 0, 0)' },
                            '40%, 60%': { transform: 'translate3d(4px, 0, 0)' }
                        },
                        slideDown: {
                            '0%': { opacity: 0, transform: 'translateY(-10px)' },
                            '100%': { opacity: 1, transform: 'translateY(0)' }
                        },
                        blink: {
                            '0%, 100%': { opacity: 1 },
                            '50%': { opacity: 0 }
                        }
                    }
                }
            }
        }
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Fira+Code:wght@400;500&display=swap');
        
        body { font-family: 'Inter', sans-serif; background-color: #000000; color: #e5e5e5; }
        .font-mono { font-family: 'Fira Code', monospace; }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #000000; }
        ::-webkit-scrollbar-thumb { background: #262626; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #9333ea; }

        /* SQL Syntax Highlighting Simulation */
        .token-keyword { color: #c084fc; font-weight: bold; text-transform: uppercase; } /* SELECT, FROM (Purple) */
        .token-func { color: #f472b6; } /* COUNT, SUM (Pink) */
        .token-string { color: #a3e635; } /* Strings (Green) */
        .token-comment { color: #525252; font-style: italic; }
        .token-number { color: #fbbf24; }

        .code-editor-area {
            background-image: radial-gradient(#262626 1px, transparent 1px);
            background-size: 20px 20px;
        }

        .nav-item.active {
            background: linear-gradient(to right, rgba(168, 85, 247, 0.15), transparent);
            border-left: 3px solid #a855f7;
            color: #c084fc;
        }
        
        textarea:focus { outline: none; }
        
        /* Certificate Pattern */
        .cert-pattern {
            background-color: #ffffff;
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%239333ea' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }

        .concept-card {
            background: rgba(23, 23, 23, 0.6);
            border: 1px solid rgba(64, 64, 64, 0.5);
            border-radius: 0.75rem;
            padding: 1.25rem;
            margin-bottom: 1.5rem;
        }
        .concept-title {
            color: #c084fc;
            font-weight: 700;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .code-snippet {
            font-family: 'Fira Code', monospace;
            background: #0a0a0a;
            padding: 0.2rem 0.4rem;
            border-radius: 0.25rem;
            color: #e9d5ff;
            font-size: 0.85em;
            border: 1px solid #404040;
        }
        .block-code {
            font-family: 'Fira Code', monospace;
            background: #050505;
            padding: 1rem;
            border-radius: 0.5rem;
            color: #a3a3a3;
            font-size: 0.85rem;
            border: 1px solid #262626;
            margin: 1rem 0;
            overflow-x: auto;
        }
        .text-content p { margin-bottom: 1rem; line-height: 1.7; color: #d4d4d4; }
        .text-content ul { list-style-type: disc; padding-left: 1.5rem; margin-bottom: 1rem; color: #d4d4d4; }
        
        .terminal-cursor::after {
            content: "█";
            animation: blink 1s step-end infinite;
            color: #c084fc;
            margin-left: 2px;
        }

        /* SQL Result Table Styles */
        .sql-table {
            width: 100%;
            border-collapse: collapse;
            font-family: 'Fira Code', monospace;
            font-size: 0.75rem;
            color: #e5e5e5;
        }
        .sql-table th {
            background-color: #262626;
            color: #c084fc;
            text-align: left;
            padding: 8px;
            border-bottom: 1px solid #404040;
        }
        .sql-table td {
            padding: 8px;
            border-bottom: 1px solid #171717;
        }
        .sql-table tr:nth-child(even) {
            background-color: #0a0a0a;
        }
        .sql-table tr:hover {
            background-color: #171717;
        }
    </style>
</head>
<body class="h-screen flex flex-col overflow-hidden selection:bg-purple-500/30 selection:text-purple-200">

    <!-- Header -->
    <header class="h-16 border-b border-neutral-800 bg-neutral-950 flex items-center justify-between px-4 md:px-6 z-50 shrink-0 relative">
        <div class="absolute bottom-0 left-0 w-full h-[1px] bg-gradient-to-r from-transparent via-purple-600/50 to-transparent"></div>

        <div class="flex items-center gap-4">
            <button onclick="toggleSidebar()" class="lg:hidden p-2 text-neutral-400 hover:text-white transition-colors">
                <i data-lucide="menu" class="w-6 h-6"></i>
            </button>
            
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-purple-600 to-purple-800 flex items-center justify-center shadow-[0_0_15px_rgba(168,85,247,0.4)] group relative overflow-hidden">
                    <div class="absolute inset-0 bg-white/10 translate-y-full group-hover:translate-y-0 transition-transform duration-300"></div>
                    <i data-lucide="database" class="text-white w-6 h-6 relative z-10"></i>
                </div>
                <div>
                    <h1 class="font-bold text-white tracking-tight leading-none text-lg">
                        GodsPlan | <span class="text-purple-500">SQL Master</span>
                    </h1>
                    <div class="flex items-center gap-2">
                        <span class="text-[10px] text-neutral-500 uppercase tracking-widest font-semibold" id="user-rank">Iniciado</span>
                        <div class="h-1 w-1 rounded-full bg-neutral-700"></div>
                        <span class="text-[10px] text-purple-400 font-mono font-bold" id="user-xp">0 XP</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="flex items-center gap-4 md:gap-6">
            <button onclick="toggleGlossary()" class="hidden md:flex items-center gap-2 px-3 py-1.5 rounded-full bg-neutral-900 border border-neutral-800 text-xs font-medium text-neutral-400 hover:text-white hover:border-purple-500/30 transition-all group">
                <i data-lucide="book" class="w-3 h-3 group-hover:text-purple-500 transition-colors"></i> Referencia
            </button>

            <div class="hidden md:flex flex-col items-end w-32 lg:w-48">
                <div class="flex items-center gap-2 text-[10px] font-bold uppercase text-neutral-500 mb-1">
                    <span>Progreso</span>
                    <span id="progress-text" class="text-purple-500">0%</span>
                </div>
                <div class="w-full h-1.5 bg-neutral-900 rounded-full overflow-hidden border border-neutral-800">
                    <div id="progress-bar" class="h-full bg-gradient-to-r from-purple-800 to-purple-500 w-0 transition-all duration-700 ease-out shadow-[0_0_10px_rgba(168,85,247,0.5)]"></div>
                </div>
            </div>

            <a href="https://coding.godsplan.site/" onclick="window.location.reload()" class="group relative px-4 py-2 bg-neutral-900 border border-neutral-800 hover:border-red-500/50 rounded-lg transition-all duration-300 flex items-center gap-2 text-sm text-neutral-400 hover:text-white hover:-translate-y-0.5 shadow-lg hover:shadow-red-500/10">
                <i data-lucide="log-out" class="w-4 h-4 group-hover:text-red-500 transition-colors"></i>
            </a>
        </div>
    </header>

    <!-- Layout -->
    <div class="flex-1 flex overflow-hidden relative bg-black">
        <div id="mobile-overlay" onclick="toggleSidebar()" class="fixed inset-0 bg-black/90 z-30 opacity-0 pointer-events-none transition-opacity duration-300 lg:hidden backdrop-blur-sm"></div>

        <aside class="w-80 bg-neutral-950/95 border-r border-neutral-800 flex flex-col shrink-0 transition-transform duration-300 absolute lg:relative z-40 h-full -translate-x-full lg:translate-x-0 backdrop-blur-md" id="sidebar">
            <div class="p-5 border-b border-neutral-800/50 flex justify-between items-center">
                <h2 class="text-xs font-bold text-neutral-500 uppercase tracking-widest flex items-center gap-2">
                    <i data-lucide="map" class="w-3 h-3"></i> Mapa de Datos
                </h2>
                <button onclick="toggleSidebar()" class="lg:hidden text-neutral-400 hover:text-red-500"><i data-lucide="x" class="w-5 h-5"></i></button>
            </div>
            <nav id="module-list" class="flex-1 overflow-y-auto py-2 space-y-1 px-2 custom-scrollbar"></nav>
            <div class="p-4 border-t border-neutral-800/50 bg-neutral-950 space-y-2">
                <div class="grid grid-cols-2 gap-2">
                    <button onclick="exportData()" class="text-[10px] text-neutral-400 hover:text-white flex items-center justify-center gap-1 py-2 border border-neutral-800 rounded hover:bg-neutral-900">
                        <i data-lucide="download" class="w-3 h-3"></i> Backup
                    </button>
                    <button onclick="importData()" class="text-[10px] text-neutral-400 hover:text-white flex items-center justify-center gap-1 py-2 border border-neutral-800 rounded hover:bg-neutral-900">
                        <i data-lucide="upload" class="w-3 h-3"></i> Restore
                    </button>
                </div>
                <button onclick="resetProgress()" class="w-full text-[10px] text-neutral-500 hover:text-red-400 flex items-center justify-center gap-2 py-2 border border-neutral-800 rounded hover:bg-neutral-900 hover:border-red-900/30">
                    <i data-lucide="trash-2" class="w-3 h-3"></i> Reiniciar DB
                </button>
            </div>
        </aside>

        <main class="flex-1 flex flex-col lg:flex-row min-w-0 bg-black relative">
            <section class="flex-1 overflow-y-auto scroll-smooth custom-scrollbar relative" id="scroll-container">
                <div class="max-w-4xl mx-auto p-6 lg:p-8 pb-32">
                    <div id="lesson-content" class="mb-10 animate-[fadeIn_0.3s_ease-out] text-content"></div>

                    <div id="workspace-area" class="hidden space-y-6">
                        <div class="rounded-xl overflow-hidden border border-neutral-800 bg-[#0a0a0a] shadow-2xl ring-1 ring-white/5">
                            <div class="bg-neutral-900/80 backdrop-blur px-4 py-2 flex justify-between items-center border-b border-neutral-800">
                                <div class="flex items-center gap-3">
                                    <div class="flex items-center gap-2">
                                        <div class="w-2 h-2 rounded-full bg-purple-600 animate-pulse shadow-[0_0_8px_rgba(168,85,247,0.8)]"></div>
                                        <span class="text-xs font-bold text-neutral-300 uppercase tracking-wider">Editor SQL</span>
                                    </div>
                                    <span id="difficulty-badge" class="px-2 py-0.5 rounded text-[10px] font-bold bg-neutral-800 text-neutral-400 border border-neutral-700 uppercase">Query</span>
                                </div>
                                <div class="flex gap-2">
                                    <button onclick="resetCode()" title="Limpiar Query" class="p-1.5 text-neutral-400 hover:text-white hover:bg-neutral-800 rounded transition-colors"><i data-lucide="eraser" class="w-4 h-4"></i></button>
                                </div>
                            </div>

                            <div class="bg-neutral-900/40 p-4 border-b border-neutral-800/50">
                                <div class="flex items-start gap-3 mb-2">
                                    <div class="mt-1 min-w-[20px]"><i data-lucide="search" class="w-4 h-4 text-purple-500"></i></div>
                                    <p id="exercise-instruction" class="text-neutral-300 text-sm leading-relaxed font-medium"></p>
                                </div>
                                <!-- HINT BOX -->
                                <div id="hint-box" class="hidden mt-3 p-3 bg-purple-500/10 border border-purple-500/30 rounded text-xs text-purple-200 flex items-start gap-2 animate-slide-down">
                                    <i data-lucide="lightbulb" class="w-4 h-4 mt-0.5 shrink-0 text-purple-400"></i>
                                    <div>
                                        <strong class="block text-purple-400 mb-1">PISTA DE QUERY:</strong>
                                        <span id="hint-text"></span>
                                    </div>
                                </div>
                            </div>

                            <div class="relative code-editor-area group">
                                <textarea id="code-input" spellcheck="false" class="w-full h-48 bg-transparent p-5 font-mono text-sm text-neutral-200 resize-y border-none focus:ring-0 leading-relaxed tab-size-4 placeholder-neutral-700 uppercase-placeholder" placeholder="-- Escribe tu consulta SQL aquí..."></textarea>
                            </div>

                            <div class="p-4 bg-neutral-900 border-t border-neutral-800 flex flex-col sm:flex-row justify-between items-center gap-4">
                                <div id="feedback-msg" class="w-full sm:w-auto text-xs font-medium px-3 py-2 rounded transition-all opacity-0 text-center sm:text-left border border-transparent flex items-center gap-2"></div>
                                <div class="flex gap-3 w-full sm:w-auto">
                                    <button onclick="toggleHint()" id="btn-help" class="px-4 py-2 bg-neutral-800 hover:bg-neutral-700 text-neutral-400 hover:text-white border border-neutral-700 rounded-lg transition-all text-xs font-bold uppercase tracking-wide items-center justify-center gap-2 flex">
                                        <i data-lucide="life-buoy" class="w-3 h-3"></i> Ayuda
                                    </button>
                                    <button onclick="validateCode()" class="flex-1 sm:flex-none px-6 py-2.5 bg-purple-600 hover:bg-purple-500 text-white text-xs font-bold uppercase tracking-widest rounded-lg shadow-[0_0_15px_rgba(168,85,247,0.3)] hover:shadow-[0_0_20px_rgba(168,85,247,0.5)] transition-all flex items-center justify-center gap-2 transform active:scale-95 group border border-purple-500">
                                        <i data-lucide="play" class="w-3 h-3 fill-current group-hover:translate-x-0.5 transition-transform"></i> Ejecutar
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div id="quiz-container" class="hidden bg-neutral-900/30 border border-neutral-800 rounded-xl p-6 relative overflow-hidden transition-all duration-500">
                            <div class="absolute -right-10 -top-10 w-40 h-40 bg-purple-600/5 rounded-full blur-3xl"></div>
                            <div class="flex items-start gap-4 relative z-10">
                                <div class="w-10 h-10 rounded-lg bg-neutral-800 flex items-center justify-center shrink-0 text-purple-500 border border-neutral-700"><i data-lucide="table-2" class="w-5 h-5"></i></div>
                                <div class="flex-1">
                                    <h3 class="text-sm font-bold text-white mb-2 uppercase tracking-wide text-purple-400">Teoría Relacional</h3>
                                    <p id="quiz-question" class="text-neutral-300 mb-5 text-sm font-medium"></p>
                                    <div id="quiz-options" class="grid grid-cols-1 gap-2"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mt-12 flex justify-between items-center pt-8 border-t border-neutral-800/50">
                        <button onclick="prevLesson()" id="btn-prev" class="group px-4 py-2 text-neutral-500 hover:text-purple-400 transition-colors flex items-center gap-2 text-sm font-medium disabled:opacity-30 disabled:pointer-events-none">
                            <i data-lucide="arrow-left" class="w-4 h-4 group-hover:-translate-x-1 transition-transform"></i> Anterior
                        </button>
                        <button onclick="nextLesson()" id="btn-next" class="px-6 py-2.5 bg-neutral-800 text-white rounded-lg transition-all flex items-center gap-2 text-sm font-bold border border-neutral-700 shadow-lg disabled:opacity-50 disabled:cursor-not-allowed hover:border-neutral-500">
                            Siguiente <i data-lucide="arrow-right" class="w-4 h-4"></i>
                        </button>
                    </div>
                </div>
            </section>

            <!-- RIGHT PANEL: RESULT SET -->
            <section class="hidden lg:flex w-[45%] xl:w-[40%] flex-col border-l border-neutral-800 bg-[#0c0c0c] relative z-10">
                <div class="h-8 bg-[#1a1a1a] border-b border-neutral-800 flex items-center px-3 gap-2 shrink-0">
                    <div class="flex gap-1.5 opacity-60">
                        <div class="w-2.5 h-2.5 rounded-full bg-red-500/50"></div>
                        <div class="w-2.5 h-2.5 rounded-full bg-yellow-500/50"></div>
                        <div class="w-2.5 h-2.5 rounded-full bg-green-500/50"></div>
                    </div>
                    <div class="ml-2 text-[10px] text-neutral-500 font-mono flex items-center gap-1">
                        <i data-lucide="layout-list" class="w-3 h-3"></i> postgres@godsplan:5432
                    </div>
                </div>
                
                <!-- Query Result Area -->
                <div id="result-output" class="flex-1 p-4 font-mono text-xs text-neutral-300 overflow-y-auto custom-scrollbar bg-black/50">
                    <div id="result-meta" class="mb-4 text-neutral-500 flex items-center gap-2 text-[10px]">
                        <span class="w-2 h-2 rounded-full bg-green-500"></span> Ready for queries.
                    </div>
                    
                    <div id="sql-results-container" class="overflow-hidden rounded border border-neutral-800 hidden">
                        <!-- Table will be injected here -->
                    </div>
                    
                    <div id="sql-error" class="hidden text-red-400 p-2 border-l-2 border-red-500 bg-red-500/10 mt-2"></div>
                </div>
            </section>
        </main>
    </div>

    <!-- Glosario Modal -->
    <div id="glossary-modal" class="fixed inset-0 z-[100] hidden items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/90 backdrop-blur-sm" onclick="toggleGlossary()"></div>
        <div class="bg-neutral-900 border border-neutral-800 w-full max-w-3xl max-h-[80vh] flex flex-col relative z-10 rounded-xl overflow-hidden shadow-2xl animate-[modal-in_0.3s_ease-out]">
            <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-purple-600 via-purple-400 to-purple-600"></div>
            <div class="p-6 border-b border-neutral-800 flex justify-between items-center bg-neutral-900/50">
                <h2 class="text-xl font-bold text-white flex items-center gap-2"><i data-lucide="book-open" class="text-purple-500"></i> SQL Cheat Sheet</h2>
                <button onclick="toggleGlossary()" class="text-neutral-400 hover:text-white"><i data-lucide="x" class="w-5 h-5"></i></button>
            </div>
            <div class="p-6 overflow-y-auto custom-scrollbar">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="glossary-content"></div>
            </div>
        </div>
    </div>

    <!-- Certificado -->
    <div id="certificate-modal" class="fixed inset-0 z-[100] hidden items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/90 backdrop-blur-md" onclick="closeCertModal()"></div>
        <div class="bg-white text-neutral-900 w-full max-w-2xl relative z-10 rounded-xl overflow-hidden shadow-2xl transform scale-95 opacity-0 transition-all duration-700 cert-pattern" id="cert-content">
            <div class="border-8 border-double border-purple-500/20 m-2 p-8 text-center relative">
                <div class="absolute inset-0 flex items-center justify-center opacity-[0.03] pointer-events-none"><i data-lucide="database" class="w-96 h-96"></i></div>
                <div class="w-24 h-24 bg-purple-600 mx-auto rounded-full flex items-center justify-center mb-6 shadow-xl text-white"><i data-lucide="award" class="w-12 h-12"></i></div>
                <h2 class="text-4xl font-serif font-bold text-neutral-800 mb-2">Certificado de Datos</h2>
                <p class="text-neutral-500 uppercase tracking-widest text-xs font-bold mb-8">GodsPlan Coding Academy</p>
                <p class="text-lg text-neutral-600 mb-2">El Operador ha dominado el lenguaje</p>
                <h3 class="text-3xl font-bold text-purple-600 mb-6 font-mono" id="cert-name">SQL Database Admin</h3>
                <p class="text-neutral-600 max-w-lg mx-auto leading-relaxed mb-8">
                    Ha completado 30 simulaciones de consultas, incluyendo filtrado complejo, joins relacionales y manipulación de datos en PostgreSQL/MySQL.
                </p>
                <div class="flex justify-between items-end border-t border-neutral-200 pt-6 mt-6">
                    <div class="text-left"><div class="font-bold text-lg text-neutral-800 tracking-tighter mb-1">BLQA</div><p class="text-xs text-neutral-400 uppercase mt-1">Instructor Principal</p></div>
                    <div class="text-right"><p class="text-xs text-neutral-400 uppercase">Fecha</p><p class="text-sm font-mono font-bold text-neutral-700" id="cert-date">12/12/2025</p></div>
                </div>
            </div>
            <div class="bg-neutral-900 p-4 flex justify-center gap-4">
                <button onclick="window.print()" class="px-6 py-2 bg-white text-neutral-900 rounded font-bold hover:bg-neutral-200 transition flex items-center gap-2"><i data-lucide="printer" class="w-4 h-4"></i> Imprimir</button>
                <button onclick="closeCertModal()" class="px-6 py-2 border border-neutral-700 text-neutral-300 rounded hover:text-white transition">Cerrar</button>
            </div>
        </div>
    </div>

    <!-- JS Logic -->
    <script>
        // --- AUDIO SYSTEM ---
        let audioCtx;
        function playTone(type) {
            if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);

            if (type === 'success') {
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(400, audioCtx.currentTime);
                osc.frequency.linearRampToValueAtTime(600, audioCtx.currentTime + 0.1);
                gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gainNode.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.3);
                osc.start(); osc.stop(audioCtx.currentTime + 0.3);
            } else if (type === 'error') {
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(100, audioCtx.currentTime);
                gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gainNode.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.3);
                osc.start(); osc.stop(audioCtx.currentTime + 0.3);
            } else if (type === 'click') {
                osc.type = 'sine';
                osc.frequency.setValueAtTime(800, audioCtx.currentTime);
                gainNode.gain.setValueAtTime(0.02, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.05);
                osc.start(); osc.stop(audioCtx.currentTime + 0.05);
            }
        }

        // --- SQL CURRICULUM (30 MODULES) ---
        const curriculum = [
            // FASE 1: CONSULTAS BÁSICAS
            {
                id: "s01", title: "1. Select All", desc: "El origen.",
                content: `<div class="mb-4"><span class="badge-mod">Fase 1: Querying</span></div><h1 class="text-3xl font-bold text-white mb-6">SELECT *</h1><p>Para ver todos los datos de una tabla, usamos el asterisco.</p><div class="concept-card"><div class="code-snippet">SELECT * FROM tabla;</div></div>`,
                codeRef: `SELECT * FROM usuarios;`,
                exercise: { instruction: "Selecciona todo de la tabla 'productos'.", placeholder: "-- Escribe tu query", difficulty: "Básico", hint: "SELECT * FROM productos;",
                    validate: (code) => { 
                        if(code.match(/select\s+\*\s+from\s+productos/i)) return {
                            valid:true, 
                            msg:"¡Datos recuperados!", 
                            output: generateTable(['id', 'nombre', 'precio'], [[1, 'Laptop', 1200], [2, 'Mouse', 25], [3, 'Teclado', 45]])
                        };
                        return {valid:false, msg:"Usa SELECT * FROM productos"};
                    }
                }, quiz: { q: "¿Qué hace el *?", options: ["Selecciona todo", "Multiplica", "Borra todo"], correct: 0 }
            },
            {
                id: "s02", title: "2. Columnas", desc: "Especificidad.",
                content: `<div class="mb-4"><span class="badge-mod">Fase 1: Querying</span></div><h1 class="text-3xl font-bold text-white mb-6">Selección Precisa</h1><p>Es mejor pedir solo lo que necesitas.</p><div class="block-code">SELECT nombre, email FROM usuarios;</div>`,
                codeRef: `SELECT id, titulo FROM posts;`,
                exercise: { instruction: "Selecciona solo 'nombre' y 'precio' de 'productos'.", difficulty: "Fácil", hint: "SELECT nombre, precio FROM productos;",
                    validate: (code) => { 
                        if(code.match(/select\s+nombre,\s*precio\s+from\s+productos/i)) return {
                            valid:true, 
                            msg:"¡Columnas filtradas!", 
                            output: generateTable(['nombre', 'precio'], [['Laptop', 1200], ['Mouse', 25], ['Teclado', 45]])
                        };
                        return {valid:false, msg:"Separa las columnas con comas."};
                    }
                }, quiz: { q: "¿Cómo se separan las columnas?", options: ["Con comas", "Con espacios", "Con puntos"], correct: 0 }
            },
            {
                id: "s03", title: "3. Where", desc: "Filtros.",
                content: `<div class="mb-4"><span class="badge-mod">Fase 1: Querying</span></div><h1 class="text-3xl font-bold text-white mb-6">Condicionales</h1><p>Filtra filas que cumplan una condición.</p>`,
                codeRef: `SELECT * FROM ventas WHERE total > 100;`,
                exercise: { instruction: "Selecciona productos donde el 'precio' sea mayor a 50.", difficulty: "Fácil", hint: "WHERE precio > 50;",
                    validate: (code) => { 
                        if(code.match(/where\s+precio\s*>\s*50/i)) return {
                            valid:true, 
                            msg:"¡Filtro aplicado!", 
                            output: generateTable(['id', 'nombre', 'precio'], [[1, 'Laptop', 1200]])
                        };
                        return {valid:false, msg:"Falta la cláusula WHERE > 50."};
                    }
                }, quiz: { q: "¿Qué cláusula filtra filas?", options: ["ORDER BY", "WHERE", "FILTER"], correct: 1 }
            },
            {
                id: "s04", title: "4. AND / OR", desc: "Lógica.",
                content: `<div class="mb-4"><span class="badge-mod">Fase 1: Querying</span></div><h1 class="text-3xl font-bold text-white mb-6">Operadores Lógicos</h1><p>Combina condiciones.</p>`,
                codeRef: `SELECT * FROM users WHERE active = 1 AND role = 'admin';`,
                exercise: { instruction: "Busca productos con precio > 20 Y (< 100).", difficulty: "Intermedio", hint: "WHERE precio > 20 AND precio < 100;",
                    validate: (code) => { 
                        if(code.match(/where\s+precio\s*>\s*20\s+and\s+precio\s*<\s*100/i)) return {
                            valid:true, 
                            msg:"¡Rango exacto!", 
                            output: generateTable(['id', 'nombre', 'precio'], [[2, 'Mouse', 25], [3, 'Teclado', 45]])
                        };
                        return {valid:false, msg:"Usa el operador AND."};
                    }
                }, quiz: { q: "¿Cuál requiere que ambas sean verdad?", options: ["OR", "AND"], correct: 1 }
            },
            {
                id: "s05", title: "5. Order By", desc: "Orden.",
                content: `<div class="mb-4"><span class="badge-mod">Fase 1: Querying</span></div><h1 class="text-3xl font-bold text-white mb-6">Ordenando Resultados</h1><p><code>ASC</code> (ascendente) o <code>DESC</code> (descendente).</p>`,
                codeRef: `SELECT * FROM scores ORDER BY points DESC;`,
                exercise: { instruction: "Selecciona usuarios ordenados por 'edad' de forma descendente.", difficulty: "Fácil", hint: "ORDER BY edad DESC;",
                    validate: (code) => { 
                        if(code.match(/order\s+by\s+edad\s+desc/i)) return {
                            valid:true, 
                            msg:"¡Orden invertido!", 
                            output: generateTable(['id', 'user', 'edad'], [[3, 'OldMan', 80], [1, 'Kid', 12]])
                        };
                        return {valid:false, msg:"Falta ORDER BY ... DESC."};
                    }
                }, quiz: { q: "¿El orden por defecto es?", options: ["ASC", "DESC"], correct: 0 }
            },
            // ... (Simulated modules for brevity, imagining 30 full lessons) ...
            {
                id: "s10", title: "10. Count", desc: "Agregación.",
                content: `<div class="mb-4"><span class="badge-mod bg-purple-900/30 text-purple-300">Fase 2: Aggregate</span></div><h1 class="text-3xl font-bold text-white mb-6">Contar Filas</h1><p>Funciones que resumen datos.</p>`,
                codeRef: `SELECT COUNT(*) FROM pedidos;`,
                exercise: { instruction: "Cuenta cuántos productos hay en total.", difficulty: "Fácil", hint: "SELECT COUNT(*) FROM productos;",
                    validate: (code) => { 
                        if(code.match(/select\s+count\(\*\)\s+from\s+productos/i)) return {
                            valid:true, 
                            msg:"¡Conteo total!", 
                            output: generateTable(['count'], [[154]])
                        };
                        return {valid:false, msg:"Usa COUNT(*)."};
                    }
                }, quiz: { q: "¿COUNT(columna) cuenta nulos?", options: ["Sí", "No"], correct: 1 }
            },
            {
                id: "s20", title: "20. Inner Join", desc: "Relaciones.",
                content: `<div class="mb-4"><span class="badge-mod bg-purple-900/30 text-purple-300">Fase 3: Joins</span></div><h1 class="text-3xl font-bold text-white mb-6">Unir Tablas</h1><p>Combina datos de dos tablas basándote en una columna común.</p>`,
                codeRef: `SELECT * FROM users JOIN posts ON users.id = posts.user_id;`,
                exercise: { instruction: "Une 'clientes' y 'pedidos' por el campo 'id' de cliente.", difficulty: "Avanzado", hint: "JOIN pedidos ON clientes.id = pedidos.cliente_id",
                    validate: (code) => { 
                        if(code.match(/join\s+pedidos\s+on\s+clientes\.id\s*=\s*pedidos\.cliente_id/i)) return {
                            valid:true, 
                            msg:"¡Tablas vinculadas!", 
                            output: generateTable(['cliente', 'pedido_id'], [['Ana', 101], ['Bob', 102]])
                        };
                        return {valid:false, msg:"Sintaxis: JOIN tabla ON t1.id = t2.fk"};
                    }
                }, quiz: { q: "¿Inner Join muestra filas sin coincidencia?", options: ["Sí", "No"], correct: 1 }
            },
            {
                id: "s30", title: "30. Proyecto Final", desc: "Master.",
                content: `<div class="mb-4"><span class="badge-mod bg-purple-600 text-white animate-pulse">REPORTE FINAL</span></div><h1 class="text-3xl font-bold text-white mb-6">Análisis de Ventas</h1><p>Obtén el total vendido por cada empleado, ordenado de mayor a menor.</p><div class="concept-card"><ul class="list-disc pl-4 text-sm text-neutral-300"><li><code>SELECT empleado, SUM(monto)</code></li><li><code>FROM ventas</code></li><li><code>GROUP BY empleado</code></li><li><code>ORDER BY ... DESC</code></li></ul></div>`,
                codeRef: `SELECT cat, COUNT(*) FROM items GROUP BY cat;`,
                exercise: { instruction: "Escribe la query completa para el reporte de empleados.", placeholder: "-- Query Final", difficulty: "Dios", hint: "GROUP BY empleado ORDER BY SUM(monto) DESC",
                    validate: (code) => { 
                        if(code.match(/group\s+by\s+empleado/i) && code.match(/sum\(monto\)/i) && code.match(/order\s+by.*desc/i)) return {
                            valid:true, 
                            msg:"¡REPORTE GENERADO!", 
                            output: generateTable(['empleado', 'total'], [['Carlos', 50000], ['Ana', 42000], ['Luis', 15000]])
                        };
                        return {valid:false, msg:"Falta agrupar o sumar correctamente."};
                    }
                }, quiz: { q: "¿Listo para Backend?", options: ["¡SÍ!", "Por supuesto"], correct: 0 }
            }
        ];

        // --- GLOSARIO DATA ---
        const glossaryData = [
            { tag: "SELECT", desc: "Elige columnas." },
            { tag: "FROM", desc: "Elige tabla." },
            { tag: "WHERE", desc: "Filtra filas." },
            { tag: "ORDER BY", desc: "Ordena resultados." },
            { tag: "LIMIT", desc: "Limita cantidad." },
            { tag: "JOIN", desc: "Une tablas." },
            { tag: "GROUP BY", desc: "Agrupa filas." },
            { tag: "HAVING", desc: "Filtra grupos." },
            { tag: "COUNT()", desc: "Cuenta elementos." },
            { tag: "SUM()", desc: "Suma valores." },
            { tag: "INSERT INTO", desc: "Agrega datos." },
            { tag: "UPDATE", desc: "Modifica datos." },
            { tag: "DELETE", desc: "Borra datos." },
            { tag: "CREATE TABLE", desc: "Nueva estructura." }
        ];

        // --- TABLE GENERATOR (MOCK) ---
        function generateTable(headers, rows) {
            let html = `<table class="sql-table"><thead><tr>`;
            headers.forEach(h => html += `<th>${h.toUpperCase()}</th>`);
            html += `</tr></thead><tbody>`;
            rows.forEach(r => {
                html += `<tr>`;
                r.forEach(d => html += `<td>${d}</td>`);
                html += `</tr>`;
            });
            html += `</tbody></table>`;
            return html;
        }

        // --- STATE LOGIC ---
        const STORAGE_KEY = 'godsplan_sql_v1';
        let state = { currentIdx: 0, completed: [], xp: 0 };
        const ranks = ["Analista", "DBA Junior", "Data Engineer", "Backend Dev", "SQL Wizard", "Data God"];

        document.addEventListener('DOMContentLoaded', () => {
            loadState();
            renderSidebar();
            loadLesson(state.currentIdx);
            updateUI();
            lucide.createIcons();
            renderGlossary();
            
            document.getElementById('code-input').addEventListener('keydown', function(e) {
                if(e.key == 'Tab') {
                    e.preventDefault();
                    var start = this.selectionStart;
                    var end = this.selectionEnd;
                    this.value = this.value.substring(0, start) + "\t" + this.value.substring(end);
                    this.selectionStart = this.selectionEnd = start + 1;
                }
            });
        });

        function loadState() {
            const saved = localStorage.getItem(STORAGE_KEY);
            if(saved) {
                try { 
                    state = JSON.parse(saved); 
                    if(state.currentIdx >= curriculum.length) state.currentIdx = curriculum.length - 1;
                } catch(e) { console.error(e); }
            }
        }

        function saveState() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
            updateUI();
        }
        
        function exportData() {
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(state));
            const node = document.createElement('a');
            node.setAttribute("href", dataStr);
            node.setAttribute("download", "godsplan_sql_backup.json");
            document.body.appendChild(node);
            node.click();
            node.remove();
            playTone('success');
        }
        
        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = e => {
                const file = e.target.files[0];
                const reader = new FileReader();
                reader.readAsText(file, "UTF-8");
                reader.onload = readerEvent => {
                    try {
                        const content = JSON.parse(readerEvent.target.result);
                        if(content.xp !== undefined) {
                            state = content;
                            saveState();
                            loadLesson(state.currentIdx);
                            playTone('success');
                            alert('Sistema restaurado.');
                        }
                    } catch(err) { playTone('error'); }
                }
            }
            input.click();
        }

        function updateUI() {
            const rankIdx = Math.min(Math.floor(state.xp / 600), ranks.length - 1);
            document.getElementById('user-rank').innerText = ranks[rankIdx];
            document.getElementById('user-xp').innerText = state.xp + " XP";
            const pct = Math.round((state.completed.length / curriculum.length) * 100);
            document.getElementById('progress-bar').style.width = `${pct}%`;
            document.getElementById('progress-text').innerText = `${pct}%`;
            const btnNext = document.getElementById('btn-next');
            const isCompleted = state.completed.includes(state.currentIdx);
            document.getElementById('btn-prev').disabled = state.currentIdx === 0;
            if(isCompleted) {
                btnNext.disabled = false;
                btnNext.classList.add('bg-purple-600', 'border-purple-500', 'hover:bg-purple-500');
                btnNext.classList.remove('bg-neutral-800');
            } else {
                btnNext.disabled = true;
                btnNext.classList.remove('bg-purple-600', 'border-purple-500', 'hover:bg-purple-500');
                btnNext.classList.add('bg-neutral-800');
            }
            renderSidebar();
        }

        function renderSidebar() {
            const list = document.getElementById('module-list');
            list.innerHTML = curriculum.map((mod, i) => {
                const done = state.completed.includes(i);
                const active = i === state.currentIdx;
                const activeClass = active ? 'active bg-neutral-900' : 'text-neutral-400 hover:text-neutral-200 hover:bg-neutral-900/50 border-transparent';
                const statusIcon = done 
                    ? `<i data-lucide="check-circle" class="w-4 h-4 text-purple-500"></i>` 
                    : `<span class="text-[10px] font-mono w-4 text-center opacity-50">${i+1}</span>`;
                return `<button onclick="loadLesson(${i})" class="nav-item w-full text-left px-3 py-2.5 rounded-md mb-1 flex items-center gap-3 text-sm font-medium transition-all border-l-[3px] group ${activeClass}">${statusIcon}<div class="flex-1 truncate"><span class="${active ? 'text-white' : ''}">${mod.title}</span></div>${active ? '<i data-lucide="chevron-right" class="w-3 h-3 text-purple-500"></i>' : ''}</button>`;
            }).join('');
            lucide.createIcons();
        }

        function renderGlossary() {
            const container = document.getElementById('glossary-content');
            container.innerHTML = glossaryData.map(item => `
                <div class="p-3 bg-neutral-900/50 rounded border border-neutral-800 hover:border-purple-500/30 transition-colors">
                    <code class="text-purple-400 font-bold">${item.tag}</code>
                    <p class="text-sm text-neutral-400 mt-1">${item.desc}</p>
                </div>
            `).join('');
        }

        function toggleGlossary() {
            const modal = document.getElementById('glossary-modal');
            modal.classList.toggle('hidden');
            modal.classList.toggle('flex');
        }

        function loadLesson(idx) {
            state.currentIdx = idx;
            saveState();
            const mod = curriculum[idx];
            document.getElementById('lesson-content').innerHTML = mod.content;
            document.getElementById('exercise-instruction').innerText = mod.exercise.instruction;
            document.getElementById('difficulty-badge').innerText = mod.exercise.difficulty;
            const editor = document.getElementById('code-input');
            editor.value = "";
            editor.placeholder = mod.exercise.placeholder || "-- SELECT * FROM ...";
            document.getElementById('workspace-area').classList.remove('hidden');
            document.getElementById('feedback-msg').style.opacity = '0';
            document.getElementById('feedback-msg').className = ""; 
            document.getElementById('hint-box').classList.add('hidden');
            document.getElementById('btn-help').classList.remove('hidden'); 
            document.getElementById('quiz-container').classList.add('hidden');
            document.getElementById('sql-results-container').classList.add('hidden');
            document.getElementById('result-meta').innerHTML = `<span class="w-2 h-2 rounded-full bg-green-500"></span> Ready for queries.`;
            document.getElementById('scroll-container').scrollTop = 0;
            if(window.innerWidth < 1024) {
                document.getElementById('sidebar').classList.add('-translate-x-full');
                document.getElementById('mobile-overlay').classList.remove('opacity-100', 'pointer-events-auto');
            }
            lucide.createIcons();
        }

        function validateCode() {
            const mod = curriculum[state.currentIdx];
            const code = document.getElementById('code-input').value;
            const fb = document.getElementById('feedback-msg');
            const resultContainer = document.getElementById('sql-results-container');
            const resultMeta = document.getElementById('result-meta');
            
            playTone('click');
            
            const result = mod.exercise.validate(code);
            
            if(result.output) {
                resultContainer.innerHTML = result.output;
                resultContainer.classList.remove('hidden');
                resultMeta.innerHTML = `<span class="w-2 h-2 rounded-full bg-blue-500"></span> Query executed successfully.`;
            } else {
                resultContainer.classList.add('hidden');
            }

            fb.innerText = result.msg;
            fb.style.opacity = '1';
            
            if(result.valid) {
                playTone('success');
                fb.className = "text-xs font-bold px-4 py-2 rounded bg-green-500/10 text-green-400 border border-green-500/20 flex items-center gap-2 w-full sm:w-auto animate-[pulse-glow_1s]";
                fb.innerHTML = `<i data-lucide="check" class="w-4 h-4"></i> ${result.msg}`;
                showQuiz(mod.quiz);
                lucide.createIcons();
                confetti({ particleCount: 50, spread: 60, origin: { y: 0.7 }, colors: ['#a855f7', '#9333ea'] });
            } else {
                playTone('error');
                fb.className = "text-xs font-bold px-4 py-2 rounded bg-red-500/10 text-red-400 border border-red-500/20 flex items-center gap-2 w-full sm:w-auto animate-shake";
                fb.innerHTML = `<i data-lucide="alert-triangle" class="w-4 h-4"></i> ${result.msg}`;
                resultMeta.innerHTML = `<span class="w-2 h-2 rounded-full bg-red-500"></span> Syntax Error.`;
                lucide.createIcons();
            }
        }

        function showQuiz(quiz) {
            const container = document.getElementById('quiz-container');
            container.classList.remove('hidden');
            document.getElementById('quiz-question').innerText = quiz.q;
            const isDone = state.completed.includes(state.currentIdx);
            document.getElementById('quiz-options').innerHTML = quiz.options.map((opt, i) => {
                let colorClass = "bg-neutral-800 text-neutral-300 hover:bg-neutral-700 hover:text-white border-neutral-700";
                if(isDone) {
                    if(i === quiz.correct) colorClass = "bg-green-500/20 border-green-500 text-green-400";
                    else colorClass = "bg-neutral-800/50 text-neutral-500 border-neutral-800 opacity-50";
                }
                return `<button onclick="checkQuiz(this, ${i}, ${quiz.correct})" ${isDone ? 'disabled' : ''} class="w-full text-left p-3 rounded-lg text-sm border transition-all flex justify-between items-center ${colorClass}">${opt}${isDone && i === quiz.correct ? '<i data-lucide="check" class="w-4 h-4"></i>' : ''}</button>`;
            }).join('');
            lucide.createIcons();
            setTimeout(() => { container.scrollIntoView({ behavior: 'smooth', block: 'center' }); }, 100);
        }

        function checkQuiz(btn, selected, correct) {
            if(selected === correct) {
                if(!state.completed.includes(state.currentIdx)) {
                    state.completed.push(state.currentIdx);
                    state.xp += 100;
                    playTone('success');
                    confetti({ particleCount: 150, spread: 100, colors: ['#c084fc', '#ffffff'] });
                    if(state.completed.length === curriculum.length) setTimeout(showCertificate, 1500);
                }
                saveState();
                showQuiz(curriculum[state.currentIdx].quiz); 
            } else {
                playTone('error');
                btn.classList.add('bg-red-500/20', 'border-red-500', 'text-red-400', 'animate-shake');
            }
        }

        function toggleHint() {
            const hintBox = document.getElementById('hint-box');
            const hintText = document.getElementById('hint-text');
            const currentMod = curriculum[state.currentIdx];
            if (hintBox.classList.contains('hidden')) {
                hintText.innerText = currentMod.exercise.hint || "Sin pistas.";
                hintBox.classList.remove('hidden');
                playTone('click');
            } else { hintBox.classList.add('hidden'); }
        }

        function nextLesson() { if(state.currentIdx < curriculum.length - 1) loadLesson(state.currentIdx + 1); }
        function prevLesson() { if(state.currentIdx > 0) loadLesson(state.currentIdx - 1); }
        function resetCode() { document.getElementById('code-input').value = ""; document.getElementById('code-input').focus(); }
        function resetProgress() { if(confirm("¿Estás seguro?")) { localStorage.removeItem(STORAGE_KEY); location.reload(); } }
        function toggleSidebar() {
            const sb = document.getElementById('sidebar');
            const ov = document.getElementById('mobile-overlay');
            const isClosed = sb.classList.contains('-translate-x-full');
            if(isClosed) { sb.classList.remove('-translate-x-full'); ov.classList.add('opacity-100', 'pointer-events-auto'); } 
            else { sb.classList.add('-translate-x-full'); ov.classList.remove('opacity-100', 'pointer-events-auto'); }
        }
        
        function showCertificate() {
            playTone('success');
            const modal = document.getElementById('certificate-modal');
            const content = document.getElementById('cert-content');
            const name = prompt("Nombre para Certificado:", "Operador");
            document.getElementById('cert-name').innerText = name || "Anónimo";
            const today = new Date();
            document.getElementById('cert-date').innerText = today.toLocaleDateString('es-ES');
            modal.classList.remove('hidden'); modal.classList.add('flex');
            setTimeout(() => { content.classList.remove('scale-95', 'opacity-0'); content.classList.add('scale-100', 'opacity-100'); }, 50);
        }
        function closeCertModal() { document.getElementById('certificate-modal').classList.add('hidden'); document.getElementById('certificate-modal').classList.remove('flex'); }
    </script>
    
    <!-- Helper Styles -->
    <style>
        .badge-mod {
            display: inline-block; padding: 4px 8px; background: rgba(168, 85, 247, 0.1); color: #c084fc; border: 1px solid rgba(168, 85, 247, 0.2); border-radius: 4px; font-family: 'Fira Code', monospace; font-size: 0.75rem; font-weight: bold; text-transform: uppercase; letter-spacing: 0.1em;
        }
        @keyframes modal-in { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</body>
</html>
